<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synesthesia - Harmonic Intervals</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Fullscreen Toggle -->
    <button id="fullscreenToggle" title="Fullscreen (F)">‚õ∂</button>
    
    <!-- Stream Status -->
    <div id="streamStatus">localhost:9876</div>
    
    <!-- Vignette Overlay for Alex Mode -->
    <div id="vignetteOverlay"></div>
    
    <!-- LEFT COLUMN: Audio, MIDI, Notes, Percussion, Speech, Debug -->
    <div id="ui">
        <!-- Audio Source -->
        <div class="panel">
            <h3>Audio Source</h3>
            <select id="audioSourceSelect">
                <option value="">-- Select Device --</option>
            </select>
            <button id="startBtn">üé§ Start</button>
        </div>
        
        <!-- Audio Output -->
        <div class="panel">
            <h3>Audio Output</h3>
            <select id="audioOutputSelect">
                <option value="">-- Select Output --</option>
            </select>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="audioPassthroughEnabled">
                    Audio Passthrough
                </label>
            </div>
            <div class="slider-group" id="passthroughVolumeControl" style="opacity: 0.5;">
                <label>Volume</label>
                <div class="slider-row">
                    <input type="range" id="passthroughVolume" min="0" max="100" value="80" disabled>
                    <span id="passthroughVolumeValue">80%</span>
                </div>
            </div>
        </div>
        
        <!-- MIDI Controller -->
        <div class="panel">
            <h3>MIDI Controller</h3>
            <select id="midiDeviceSelect">
                <option value="">-- Select MIDI Device --</option>
            </select>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="midiEnabled">
                    Use MIDI as Input
                </label>
            </div>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="midiSynthEnabled">
                    Play MIDI Sound
                </label>
            </div>
            <div class="slider-group" id="midiSynthVolumeControl" style="opacity: 0.5;">
                <label>Synth Volume</label>
                <div class="slider-row">
                    <input type="range" id="midiSynthVolume" min="0" max="100" value="50" disabled>
                    <span id="midiSynthVolumeValue">50%</span>
                </div>
            </div>
            <div id="midiStatus" style="color:#666; font-size:11px; margin-top:8px;">MIDI not connected</div>
        </div>
        
        <!-- Detected Notes -->
        <div class="panel">
            <h3>Detected Notes</h3>
            <div id="detectedNotes">
                <span style="color:#666">Waiting for Audio...</span>
            </div>
            <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid #333;">
                <div id="intervalDisplay">-</div>
            </div>
        </div>
        
        <!-- Percussion -->
        <div class="panel">
            <h3>Percussion</h3>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="percussionEnabled">
                    Detect Percussion
                </label>
            </div>
            <div style="margin-top: 4px;">
                <label style="font-size: 7px; color: #888;">Detection Model</label>
                <select id="percussionPreset" style="margin-top: 2px;">
                    <option value="standard">Standard</option>
                    <option value="acoustic">Acoustic Kit</option>
                    <option value="electronic">Electronic</option>
                    <option value="live">Live/Noisy</option>
                    <option value="sensitive">Sensitive</option>
                    <option value="kickFocus">Kick Focus</option>
                    <option value="hiphop">Hip-Hop/Trap</option>
                    <option value="rock">Rock/Metal</option>
                </select>
            </div>
            <div id="percussionPresetStatus" style="font-size: 7px; color: #666; margin-top: 2px; min-height: 12px;"></div>
            <div id="detectedPercussion">
                <span style="color:#666">-</span>
            </div>
        </div>
        
        <!-- Speech Recognition -->
        <div class="panel">
            <h3>Speech üåê</h3>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="speechEnabled">
                    Enable Speech Recognition
                </label>
            </div>
            <select id="speechLang" style="margin-top:4px;">
                <option value="de-DE">Deutsch</option>
                <option value="en-US">English (US)</option>
                <option value="en-GB">English (UK)</option>
                <option value="fr-FR">Fran√ßais</option>
                <option value="es-ES">Espa√±ol</option>
            </select>
            <div id="speechStatus" style="color:#888; font-size:9px; margin-top:6px; padding:4px; background:#111; border-radius:3px;">
                ‚è∏ Off
            </div>
            <div style="font-size:7px; color:#555; margin-top:3px;">
                ‚ö† Uses system microphone
            </div>
            <div id="speechText"></div>
        </div>
        
        <!-- Debug -->
        <div class="panel">
            <h3>Debug</h3>
            <div id="debugInfo"></div>
        </div>
    </div>
    
    <!-- BOTTOM BAR: Color Schema, 3D Model, Effects, AI Image -->
    <div id="ui-bottom">
        <!-- Color Schema -->
        <div class="panel" id="panelFarbschema">
            <h3>
                <span>Color Schema</span>
                <span class="header-icons">
                    <span class="visibility-btn active" id="colorVisibilityBtn" title="Enable/Disable Colors">üëÅ</span>
                    <span class="minimize-btn">‚ñº</span>
                </span>
            </h3>
            <div class="panel-content">
                <div class="schema-selector">
                    <button class="schema-btn active" data-schema="clara">Clara</button>
                    <button class="schema-btn" data-schema="alex">Alex</button>
                    <button class="schema-btn" data-schema="both">Both</button>
                </div>
                
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="blendSchemas">
                        Blend Schemas
                    </label>
                </div>
                
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="alexDegreeColors">
                        Alex: Degree Colors (I-VII)
                    </label>
                </div>
                
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="alexGradient">
                        Alex: Gradients
                    </label>
                </div>
                
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="alexVignette">
                        Alex: Vignette
                    </label>
                </div>
                
                <div class="slider-group" id="blendControl" style="display:none;">
                    <label>Clara ‚Üî Alex</label>
                    <div class="slider-row">
                        <input type="range" id="blendSlider" min="0" max="100" value="50">
                        <span id="blendValue">50%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 3D Model -->
        <div class="panel" id="panel3DModell">
            <h3>
                <span>3D Model</span>
                <span class="header-icons">
                    <span class="info-btn" id="intervalInfoBtn" title="Interval Overview">‚ÑπÔ∏è</span>
                    <span class="visibility-btn" id="modelVisibilityBtn" title="Show/Hide Model">üëÅ</span>
                    <span class="minimize-btn">‚ñº</span>
                </span>
            </h3>
            <div class="panel-content">
                <div class="model-set-row">
                    <select id="modelSetSelect">
                        <option value="">Standard (Legacy)</option>
                    </select>
                    <button id="scanModelSetsBtn" title="Scan for Model Sets">üîÑ</button>
                </div>
                <div id="modelSetStatus" style="font-size: 7px; color: #666; margin-bottom: 3px;"></div>
                <div class="slider-group">
                    <label>Scale</label>
                    <div class="slider-row">
                        <input type="range" id="scaleSlider" min="0.1" max="5" step="0.1" value="1">
                        <span id="scaleValue">1.0</span>
                    </div>
                </div>
                <div class="slider-group">
                    <label>Sensitivity</label>
                    <div class="slider-row">
                        <input type="range" id="sensitivitySlider" min="0.01" max="0.2" step="0.01" value="0.05">
                        <span id="sensitivityValue">0.05</span>
                    </div>
                </div>
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="morphingEnabled" checked>
                        Morphing
                    </label>
                </div>
                <div class="slider-group" id="morphDurationControl">
                    <label>Morph Duration</label>
                    <div class="slider-row">
                        <input type="range" id="morphDuration" min="100" max="1500" step="50" value="500">
                        <span id="morphDurationValue">500ms</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Video Texture -->
        <div class="panel" id="panelVideoTexture">
            <h3>
                <span>Video Texture</span>
                <span class="header-icons">
                    <span class="visibility-btn" id="videoVisibilityBtn" title="Enable/Disable Video Texture">üëÅ</span>
                    <span class="minimize-btn">‚ñº</span>
                </span>
            </h3>
            <div class="panel-content">
                <!-- Load Videos -->
                <div class="video-load-row">
                    <label class="video-load-btn" title="Load Video Files">
                        üìÇ
                        <input type="file" id="videoFileInput" accept="video/*" multiple style="display:none;">
                    </label>
                    <span id="videoStatus" style="font-size: 7px; color: #666; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">üìπ No video</span>
                    <span id="videoLibraryCount" style="font-size: 7px; color: #888;">0 videos</span>
                </div>
                
                <!-- Video Library Thumbnails -->
                <div id="videoLibrary" class="video-library">
                    <span class="video-library-empty">Drop videos here or click üìÇ</span>
                </div>
                
                <!-- Playback Controls -->
                <div class="video-controls">
                    <button id="videoPrev" class="video-ctrl-btn" title="Previous">‚èÆ</button>
                    <button id="videoPlayPause" class="video-ctrl-btn" title="Play/Pause">‚ñ∂</button>
                    <button id="videoNext" class="video-ctrl-btn" title="Next">‚è≠</button>
                    <input type="range" id="videoProgress" min="0" max="100" value="0" class="video-progress">
                    <span id="videoTime" style="font-size: 7px; color: #888; min-width: 45px;">0:00</span>
                </div>
                
                <!-- Settings Row -->
                <div style="display: flex; gap: 8px; margin-top: 4px;">
                    <label class="interaction-mode" style="margin: 0; color: #fff;">
                        <input type="checkbox" id="videoLoop" checked>
                        <span style="font-size: 8px; color: #ccc;">Loop</span>
                    </label>
                    <label class="interaction-mode" style="margin: 0; color: #fff;">
                        <input type="checkbox" id="videoAutoCycle">
                        <span style="font-size: 8px; color: #ccc;">Auto-Cycle</span>
                    </label>
                </div>
                
                <!-- Speed -->
                <div class="slider-group">
                    <label>Speed</label>
                    <div class="slider-row">
                        <input type="range" id="videoRate" min="0.25" max="2" step="0.25" value="1">
                        <span id="videoRateValue">1.0x</span>
                    </div>
                </div>
                
                <!-- Blend Mode -->
                <div style="margin-top: 4px;">
                    <label style="font-size: 7px; color: #888;">Blend Mode</label>
                    <select id="videoBlendMode" style="margin-top: 2px;">
                        <option value="replace">Replace</option>
                        <option value="multiply">Multiply</option>
                        <option value="add">Add (Glow)</option>
                        <option value="overlay">Overlay</option>
                    </select>
                </div>
                
                <!-- Blend Amount -->
                <div class="slider-group">
                    <label>Intensity</label>
                    <div class="slider-row">
                        <input type="range" id="videoBlendAmount" min="0" max="100" value="100">
                        <span id="videoBlendValue">100%</span>
                    </div>
                </div>
                
                <!-- Displacement -->
                <div class="slider-group">
                    <label>Displacement</label>
                    <div class="slider-row">
                        <input type="range" id="videoDisplacement" min="-1000" max="1000" value="0">
                        <span id="videoDisplacementValue">0</span>
                    </div>
                </div>
                
                <!-- Audio-Reactive Displacement -->
                <div class="interaction-mode">
                    <label style="color: #ccc;">
                        <input type="checkbox" id="videoDisplacementAudio">
                        <span style="font-size: 8px;">Audio-Reactive</span>
                    </label>
                </div>
                
                <!-- Apply to All Models -->
                <div class="interaction-mode">
                    <label style="color: #ccc;">
                        <input type="checkbox" id="videoApplyToAll" checked>
                        <span style="font-size: 8px;">Apply to All Models</span>
                    </label>
                </div>
                
                <!-- Clear Button -->
                <button id="videoClearAll" class="reset-btn" style="margin-top: 4px; font-size: 7px;">üóë Clear All</button>
            </div>
        </div>
        
        <!-- Effects -->
        <div class="panel" id="panelEffekte">
            <h3><span>Effects</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="panel-content">
                <div class="effect-grid">
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="glitch">Glitch</button>
                        <div class="effect-slider" id="glitchSliderContainer">
                            <input type="range" id="glitchIntensity" min="0" max="100" value="50">
                            <div class="effect-slider-value"><span id="glitchIntensityValue">50%</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="pulse">Pulse</button>
                        <div class="effect-slider" id="pulseSliderContainer">
                            <input type="range" id="pulseIntensity" min="0" max="100" value="50">
                            <div class="effect-slider-value"><span id="pulseIntensityValue">50%</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="edge">Edge</button>
                        <div class="effect-slider" id="edgeSliderContainer">
                            <input type="range" id="edgeIntensity" min="0" max="100" value="50">
                            <div class="effect-slider-value">Intensity: <span id="edgeIntensityValue">50%</span></div>
                            <input type="range" id="edgeGlow" min="0" max="100" value="30" style="margin-top:2px;">
                            <div class="effect-slider-value">Glow: <span id="edgeGlowValue">30%</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="explode">Explode</button>
                        <div class="effect-slider" id="explodeSliderContainer">
                            <input type="range" id="explodeIntensity" min="0" max="100" value="50">
                            <div class="effect-slider-value"><span id="explodeIntensityValue">50%</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="particles">‚ú® Particles</button>
                        <div class="effect-slider" id="particlesSliderContainer">
                            <input type="range" id="particlesIntensity" min="0" max="100" value="50">
                            <div class="effect-slider-value">Amount: <span id="particlesIntensityValue">50%</span></div>
                            <input type="range" id="particlesSize" min="0" max="100" value="30" style="margin-top:2px;">
                            <div class="effect-slider-value">Size: <span id="particlesSizeValue">30%</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="trails">‚òÅ Trails</button>
                        <div class="effect-slider" id="trailsSliderContainer">
                            <input type="range" id="trailsIntensity" min="0" max="100" value="70">
                            <div class="effect-slider-value">Afterglow: <span id="trailsIntensityValue">70%</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="fractal">üåÄ Fractal</button>
                        <div class="effect-slider" id="fractalSliderContainer">
                            <input type="range" id="fractalIntensity" min="0" max="100" value="50">
                            <div class="effect-slider-value">Intensity: <span id="fractalIntensityValue">50%</span></div>
                            <input type="range" id="fractalScale" min="1" max="100" value="30" style="margin-top:2px;">
                            <div class="effect-slider-value">Scale: <span id="fractalScaleValue">30%</span></div>
                            <input type="range" id="fractalSpeed" min="0" max="100" value="50" style="margin-top:2px;">
                            <div class="effect-slider-value">Speed: <span id="fractalSpeedValue">50%</span></div>
                            <input type="range" id="fractalOctaves" min="1" max="6" value="3" style="margin-top:2px;">
                            <div class="effect-slider-value">Complexity: <span id="fractalOctavesValue">3</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="kaleidoscope">üîÆ Kaleidoscope</button>
                        <div class="effect-slider" id="kaleidoscopeSliderContainer">
                            <input type="range" id="kaleidoscopeSegments" min="2" max="16" value="6">
                            <div class="effect-slider-value">Segments: <span id="kaleidoscopeSegmentsValue">6</span></div>
                            <input type="range" id="kaleidoscopeRotation" min="0" max="360" value="0" style="margin-top:2px;">
                            <div class="effect-slider-value">Rotation: <span id="kaleidoscopeRotationValue">0¬∞</span></div>
                            <input type="range" id="kaleidoscopeZoom" min="50" max="200" value="100" style="margin-top:2px;">
                            <div class="effect-slider-value">Zoom: <span id="kaleidoscopeZoomValue">100%</span></div>
                            <label style="display:flex; align-items:center; gap:4px; margin-top:4px; font-size:8px; color:#ccc;">
                                <input type="checkbox" id="kaleidoscopeAutoRotate">
                                Auto-Rotate
                            </label>
                            <input type="range" id="kaleidoscopeSpeed" min="0" max="100" value="30" style="margin-top:2px;">
                            <div class="effect-slider-value">Speed: <span id="kaleidoscopeSpeedValue">30%</span></div>
                        </div>
                    </div>
                </div>
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="audioScaleEnabled">
                        Audio ‚Üí Scale
                    </label>
                </div>
                <div class="slider-group" id="audioScaleControl" style="opacity:0.5;">
                    <label>Scale Amount</label>
                    <div class="slider-row">
                        <input type="range" id="audioScaleAmount" min="0" max="100" value="30" disabled>
                        <span id="audioScaleAmountValue">30%</span>
                    </div>
                </div>
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="gainLinked">
                        Audio ‚Üí Brightness
                    </label>
                </div>
                <div class="slider-group">
                    <label>Black Level</label>
                    <div class="slider-row">
                        <input type="range" id="blackLevel" min="0" max="50" value="0">
                        <span id="blackLevelValue">0</span>
                    </div>
                </div>
                <button class="reset-btn" id="resetAllBtn" title="Reset all effects & artifacts">‚ö†Ô∏è Reset All</button>
            </div>
        </div>
        
        <!-- Camera Input (USB/Webcam) -->
        <div class="panel" id="panelCameraInput">
            <h3>
                <span>üì∑ Camera Input</span>
                <span class="header-icons">
                    <span class="visibility-btn" id="cameraInputVisibilityBtn" title="Enable/Disable Camera">üëÅ</span>
                    <span class="minimize-btn">‚ñº</span>
                </span>
            </h3>
            <div class="panel-content">
                <!-- Camera Selection -->
                <div style="display: flex; gap: 4px; margin-bottom: 4px;">
                    <select id="cameraInputSelect" style="flex: 1;">
                        <option value="">-- Select Camera --</option>
                    </select>
                    <button id="cameraInputRefresh" class="reset-btn" style="margin: 0; padding: 4px 6px;" title="Refresh Devices">üîÑ</button>
                </div>
                <div id="cameraInputStatus" style="font-size: 7px; color: #666; margin-bottom: 4px;">‚ö´ Disconnected</div>
                
                <!-- Opacity -->
                <div class="slider-group">
                    <label>Camera Opacity</label>
                    <div class="slider-row">
                        <input type="range" id="cameraInputOpacity" min="0" max="100" value="50">
                        <span id="cameraInputOpacityValue">50%</span>
                    </div>
                </div>
                
                <!-- Blend Mode -->
                <div style="margin-top: 4px;">
                    <label style="font-size: 7px; color: #888;">Blend Mode</label>
                    <select id="cameraInputBlendMode" style="margin-top: 2px;">
                        <option value="normal">Normal</option>
                        <option value="overlay">Overlay</option>
                        <option value="multiply">Multiply</option>
                        <option value="screen">Screen</option>
                        <option value="add">Add (Glow)</option>
                        <option value="difference">Difference</option>
                        <option value="hard-light">Hard Light</option>
                        <option value="soft-light">Soft Light</option>
                    </select>
                </div>
                
                <!-- Audio-Reactive -->
                <div class="interaction-mode" style="margin-top: 6px;">
                    <label>
                        <input type="checkbox" id="cameraInputAudioReactive">
                        Audio ‚Üí Opacity
                    </label>
                </div>
                
                <!-- Audio Range -->
                <div id="cameraInputAudioRange" style="margin-top: 4px; padding: 4px; background: #111; border-radius: 3px;">
                    <div class="slider-group" style="margin-bottom: 2px;">
                        <label style="font-size: 7px;">Min Opacity</label>
                        <div class="slider-row">
                            <input type="range" id="cameraInputAudioMin" min="0" max="100" value="0">
                            <span id="cameraInputAudioMinValue">0%</span>
                        </div>
                    </div>
                    <div class="slider-group">
                        <label style="font-size: 7px;">Max Opacity</label>
                        <div class="slider-row">
                            <input type="range" id="cameraInputAudioMax" min="0" max="100" value="100">
                            <span id="cameraInputAudioMaxValue">100%</span>
                        </div>
                    </div>
                </div>
                
                <!-- Mirror -->
                <div class="interaction-mode" style="margin-top: 4px;">
                    <label>
                        <input type="checkbox" id="cameraInputMirror">
                        Mirror
                    </label>
                </div>
                
                <!-- Use as 3D Texture -->
                <div class="interaction-mode" style="margin-top: 4px;">
                    <label>
                        <input type="checkbox" id="cameraInputAsTexture">
                        Use as 3D Texture
                    </label>
                </div>
                
                <!-- Apply to All Models -->
                <div class="interaction-mode" style="margin-top: 2px; margin-left: 16px;">
                    <label style="color: #ccc;">
                        <input type="checkbox" id="cameraInputApplyToAll" checked>
                        <span style="font-size: 8px;">Apply to All Models</span>
                    </label>
                </div>
                
                <!-- Skeleton Tracking -->
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333;">
                    <label style="font-size: 7px; color: #888;">ü¶¥ Body/Face/Hand Tracking</label>
                    <div id="skeletonStatus" style="font-size: 7px; color: #666; margin-top: 2px;">‚ö´ No models active</div>
                    
                    <!-- Body Tracking -->
                    <div id="skeletonModels" style="margin-top: 4px; padding: 4px; background: #111; border-radius: 3px;">
                        <div style="font-size: 7px; color: #666; margin-bottom: 3px;">Body Tracking</div>
                        <!-- MediaPipe -->
                        <div style="display: flex; align-items: center; gap: 4px; margin-bottom: 3px;">
                            <input type="checkbox" id="skeleton-mediapipe" style="margin: 0;">
                            <input type="color" id="skeleton-color-mediapipe" value="#00ff00" style="width: 18px; height: 14px; padding: 0; border: none;">
                            <label for="skeleton-mediapipe" style="font-size: 8px; color: #ccc; flex: 1;">MediaPipe (33pt)</label>
                            <span id="skeleton-status-mediapipe" style="font-size: 10px;"></span>
                        </div>
                        <!-- MoveNet Lightning -->
                        <div style="display: flex; align-items: center; gap: 4px; margin-bottom: 3px;">
                            <input type="checkbox" id="skeleton-movenet-lightning" style="margin: 0;">
                            <input type="color" id="skeleton-color-movenet-lightning" value="#ff00ff" style="width: 18px; height: 14px; padding: 0; border: none;">
                            <label for="skeleton-movenet-lightning" style="font-size: 8px; color: #ccc; flex: 1;">MoveNet Fast (17pt)</label>
                            <span id="skeleton-status-movenet-lightning" style="font-size: 10px;"></span>
                        </div>
                        <!-- MoveNet Thunder -->
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <input type="checkbox" id="skeleton-movenet-thunder" style="margin: 0;">
                            <input type="color" id="skeleton-color-movenet-thunder" value="#00ffff" style="width: 18px; height: 14px; padding: 0; border: none;">
                            <label for="skeleton-movenet-thunder" style="font-size: 8px; color: #ccc; flex: 1;">MoveNet Accurate (17pt)</label>
                            <span id="skeleton-status-movenet-thunder" style="font-size: 10px;"></span>
                        </div>
                    </div>
                    
                    <!-- Face & Hand Tracking -->
                    <div style="margin-top: 4px; padding: 4px; background: #111; border-radius: 3px;">
                        <div style="font-size: 7px; color: #666; margin-bottom: 3px;">Face & Hands</div>
                        <!-- Face -->
                        <div style="display: flex; align-items: center; gap: 4px; margin-bottom: 3px;">
                            <input type="checkbox" id="skeleton-face" style="margin: 0;">
                            <input type="color" id="skeleton-color-face" value="#ffff00" style="width: 18px; height: 14px; padding: 0; border: none;">
                            <label for="skeleton-face" style="font-size: 8px; color: #ccc; flex: 1;">üòä Face Mesh (468pt)</label>
                            <span id="skeleton-status-face" style="font-size: 10px;"></span>
                        </div>
                        <!-- Hands -->
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <input type="checkbox" id="skeleton-hands" style="margin: 0;">
                            <input type="color" id="skeleton-color-hands" value="#ff8800" style="width: 18px; height: 14px; padding: 0; border: none;">
                            <label for="skeleton-hands" style="font-size: 8px; color: #ccc; flex: 1;">‚úã Hands (21pt √ó 2)</label>
                            <span id="skeleton-status-hands" style="font-size: 10px;"></span>
                        </div>
                    </div>
                    
                    <!-- Display Options -->
                    <div id="skeletonOptions" style="margin-top: 4px; padding: 4px; background: #111; border-radius: 3px;">
                        <div class="slider-group" style="margin-bottom: 4px;">
                            <label style="font-size: 7px;">Tracking Opacity</label>
                            <div class="slider-row">
                                <input type="range" id="skeletonOpacity" min="0" max="100" value="100">
                                <span id="skeletonOpacityValue" style="font-size: 8px;">100%</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <label class="interaction-mode" style="margin: 0;">
                                <input type="checkbox" id="skeletonShowLines" checked>
                                <span style="font-size: 8px; color: #ccc;">Lines</span>
                            </label>
                            <label class="interaction-mode" style="margin: 0;">
                                <input type="checkbox" id="skeletonShowPoints" checked>
                                <span style="font-size: 8px; color: #ccc;">Points</span>
                            </label>
                            <label class="interaction-mode" style="margin: 0;">
                                <input type="checkbox" id="skeletonShowLabels">
                                <span style="font-size: 8px; color: #ccc;">Labels</span>
                            </label>
                        </div>
                        <div class="slider-group" style="margin-top: 4px;">
                            <label style="font-size: 7px;">Line Width</label>
                            <div class="slider-row">
                                <input type="range" id="skeletonLineWidth" min="1" max="10" value="3">
                                <span id="skeletonLineWidthValue" style="font-size: 8px;">3px</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 3D Model Mapping -->
                    <div style="margin-top: 4px; padding: 4px; background: #181818; border-radius: 3px; border: 1px solid #333;">
                        <div class="interaction-mode" style="margin: 0;">
                            <label>
                                <input type="checkbox" id="modelMappingEnabled">
                                <span style="font-size: 8px; color: #fff;">üéØ Map 3D Model to Tracking</span>
                            </label>
                        </div>
                        <div id="modelMappingControls" style="display: none; margin-top: 6px;">
                            <div style="margin-bottom: 4px;">
                                <label style="font-size: 7px; color: #888;">Target</label>
                                <select id="modelMappingTarget" style="margin-top: 2px; width: 100%;">
                                    <option value="none">-- Select --</option>
                                    <option value="nose">üëÉ Nose</option>
                                    <option value="face_center">üòä Face Center</option>
                                    <option value="left_hand">ü§ö Left Hand</option>
                                    <option value="right_hand">‚úã Right Hand</option>
                                    <option value="between_hands">üôå Between Hands</option>
                                </select>
                            </div>
                            <div class="slider-group" style="margin-bottom: 4px;">
                                <label style="font-size: 7px;">Smoothing</label>
                                <div class="slider-row">
                                    <input type="range" id="modelMappingSmoothing" min="0" max="95" value="30">
                                    <span id="modelMappingSmoothingValue" style="font-size: 8px;">30%</span>
                                </div>
                            </div>
                            <div class="slider-group">
                                <label style="font-size: 7px;">Scale</label>
                                <div class="slider-row">
                                    <input type="range" id="modelMappingScale" min="10" max="300" value="100">
                                    <span id="modelMappingScaleValue" style="font-size: 8px;">100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Image -->
        <div class="panel" id="panelAiBild">
            <h3><span>AI Image</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="panel-content">
                <!-- Display Mode -->
                <div class="ai-mode-selector">
                    <button class="ai-mode-btn active" data-aimode="off">Off</button>
                    <button class="ai-mode-btn" data-aimode="on">On</button>
                    <button class="ai-mode-btn" data-aimode="overlay">Overlay</button>
                </div>
                
                <!-- Provider Tabs -->
                <div class="ai-provider-tabs">
                    <button class="ai-provider-tab active" data-provider="local">üñ•Ô∏è Local</button>
                    <button class="ai-provider-tab" data-provider="mix">üåÄ Mix</button>
                    <button class="ai-provider-tab" data-provider="settings">‚öôÔ∏è</button>
                </div>
                
                <!-- Model Selection -->
                <div id="aiModelSelector" style="margin-top: 4px;">
                    <div class="ai-model-group" data-provider="local">
                        <div class="ai-model-tabs">
                            <button class="ai-model-tab active" data-model="local-sd15">üé® SD 1.5</button>
                            <button class="ai-model-tab" data-model="local-sdxl">üñºÔ∏è SDXL</button>
                            <button class="ai-model-tab" data-model="local-turbo">‚ö° Turbo</button>
                        </div>
                        <div id="localSdStatus" style="font-size: 7px; color: #888; margin-top: 2px;">üñ•Ô∏è Connecting to localhost:8188</div>
                        <button id="startComfyBtn" class="reset-btn" style="margin-top: 4px; font-size: 7px; padding: 3px 6px;">üöÄ Start ComfyUI</button>
                    </div>
                </div>
                
                <!-- Resolution Selection -->
                <div class="ai-resolution-selector" style="margin-top: 6px;">
                    <div style="display: flex; gap: 3px; flex-wrap: wrap; justify-content: center;">
                        <button class="ai-resolution-btn" data-resolution="fit" title="Fit Screen">üì∫</button>
                        <button class="ai-resolution-btn active" data-resolution="1:1" title="Square 1:1">‚óª</button>
                        <button class="ai-resolution-btn" data-resolution="16:9" title="16:9 Landscape">‚ñ¨</button>
                        <button class="ai-resolution-btn" data-resolution="9:16" title="9:16 Portrait">‚ñÆ</button>
                        <button class="ai-resolution-btn" data-resolution="4:3" title="4:3">üì∑</button>
                        <button class="ai-resolution-btn" data-resolution="3:2" title="3:2">üñº</button>
                        <button class="ai-resolution-btn" data-resolution="21:9" title="21:9 Ultra-Wide">‚îÅ</button>
                    </div>
                    <div id="aiResolutionDisplay" style="font-size: 7px; color: #888; text-align: center; margin-top: 2px;">512√ó512px</div>
                </div>
                
                <!-- Buffer Status -->
                <div id="aiModelBufferStatus" style="font-size: 8px; color: #888; margin-top: 4px;"></div>
                
                <!-- Settings -->
                <div class="interaction-mode" style="margin-top: 4px;">
                    <label>
                        <input type="checkbox" id="aiAutoGenerate">
                        Auto-Generation
                    </label>
                </div>
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="aiBufferMode">
                        Buffer Mode
                    </label>
                </div>
                
                <!-- Buffer Settings (erscheint wenn Buffer Mode aktiv) -->
                <div id="aiBufferSettings" style="display:none; padding: 4px; background: #111; border-radius: 3px; margin-top: 4px;">
                    <div class="slider-group" style="margin-bottom: 4px;">
                        <label>Buffer Size</label>
                        <div class="slider-row">
                            <input type="range" id="aiBufferSize" min="5" max="50" value="24">
                            <span id="aiBufferSizeValue">24</span>
                        </div>
                    </div>
                    <div class="interaction-mode">
                        <label>
                            <input type="checkbox" id="aiBufferLoop">
                            Loop Buffer
                        </label>
                    </div>
                    <div class="interaction-mode">
                        <label>
                            <input type="checkbox" id="aiBufferShuffle">
                            Shuffle
                        </label>
                    </div>
                    <div id="aiBufferStatus" style="font-size: 8px; color: #4f4; margin-top: 4px;">Buffer: 0/24</div>
                </div>
                
                <!-- Prompt Input -->
                <div style="display: flex; gap: 4px; margin-top: 4px;">
                    <input type="text" id="aiPromptInput" placeholder="Enter prompt..." style="flex: 1; padding: 4px 6px; font-size: 9px; background: #222; border: 1px solid #444; border-radius: 3px; color: #fff;">
                    <button class="reset-btn" id="aiClearPrompt" style="margin: 0; width: auto; padding: 4px 6px; font-size: 8px;" title="Clear prompt">‚ùå</button>
                    <button class="reset-btn" id="aiGenerateBtn" style="margin: 0; width: auto; padding: 4px 8px;">üé®</button>
                </div>
                
                <!-- Text Filter Options -->
                <div style="display: flex; gap: 8px; margin-top: 4px; font-size: 8px; color: #888;">
                    <label style="display: flex; align-items: center; gap: 3px;">
                        <input type="checkbox" id="aiFilterNouns" checked>
                        Nouns
                    </label>
                    <label style="display: flex; align-items: center; gap: 3px;">
                        <input type="checkbox" id="aiFilterVerbs">
                        Verbs
                    </label>
                    <label style="display: flex; align-items: center; gap: 3px;">
                        <input type="checkbox" id="aiFilterAdj">
                        Adjectives
                    </label>
                </div>
                
                <div id="aiCurrentInput" style="font-size: 7px; color: #666; margin-top: 2px; padding: 2px 4px; background: #0a0a0a; border-radius: 2px; min-height: 12px; word-break: break-word;">üé§ -</div>
                
                <!-- Preview -->
                <div id="aiImagePreview">
                    <span class="placeholder">No Image</span>
                </div>
                
                <!-- Buffer Thumbnails -->
                <div id="aiBufferThumbs" style="display: none; margin-top: 4px;"></div>
                
                <!-- Crossfade -->
                <div class="interaction-mode" style="margin-top: 6px;">
                    <label>
                        <input type="checkbox" id="aiCrossfadeEnabled">
                        Crossfade
                    </label>
                </div>
            </div>
        </div>
    </div>
    
    <!-- RIGHT COLUMN: Master, EQ, Pitch Detection, Beat, Camera -->
    <div id="ui-right">
        <div class="panel">
            <h3>Master</h3>
            <div class="fader-container">
                <div class="fader-value" id="gainValue">0 dB</div>
                <div class="fader-track">
                    <input type="range" id="masterGain" min="-60" max="12" step="0.5" value="0">
                    <div class="fader-db-marks">
                        <span>+12</span>
                        <span>0</span>
                        <span>-60</span>
                    </div>
                </div>
                <div class="fader-label">Gain</div>
            </div>
            <div class="level-meter">
                <div class="level-meter-fill" id="levelMeter"></div>
            </div>
        </div>
        
        <div class="panel">
            <h3>Input EQ</h3>
            <div class="eq-container">
                <div class="eq-band">
                    <label><span>Low</span><span id="eqLowValue">0</span></label>
                    <input type="range" id="eqLow" min="-24" max="24" step="0.5" value="0">
                </div>
                <div class="eq-band">
                    <label><span>Mid</span><span id="eqMidValue">0</span></label>
                    <input type="range" id="eqMid" min="-24" max="24" step="0.5" value="0">
                </div>
                <div class="eq-band">
                    <label><span>High</span><span id="eqHighValue">0</span></label>
                    <input type="range" id="eqHigh" min="-24" max="24" step="0.5" value="0">
                </div>
            </div>
            <button class="reset-btn" id="eqReset">Reset</button>
        </div>
        
        <div class="panel">
            <h3>Pitch Detection</h3>
            <div class="slider-group">
                <label>Reaction Speed</label>
                <div class="slider-row">
                    <input type="range" id="reactionSpeed" min="0" max="100" value="70">
                    <span id="reactionSpeedValue">70%</span>
                </div>
            </div>
            <div class="algo-grid" id="algoGrid">
                <button class="algo-btn active" data-algo="hps">HPS</button>
                <button class="algo-btn" data-algo="hpsWhitening">HPS+White</button>
                <button class="algo-btn" data-algo="peaks">Peaks</button>
                <button class="algo-btn" data-algo="autocorr">Autocorr</button>
                <button class="algo-btn" data-algo="cepstrum">Cepstrum</button>
                <button class="algo-btn" data-algo="yin">YIN</button>
            </div>
            <div class="algo-combine">
                <label>Combine:</label>
                <select id="algoCombineMode">
                    <option value="union">Union (all notes)</option>
                    <option value="intersection">Intersection</option>
                    <option value="voting">Voting (majority)</option>
                    <option value="strongest">Strongest confidence</option>
                </select>
            </div>
            <div class="algo-description" id="algoDescription">
                Click multiple algorithms for ensemble detection
            </div>
        </div>
        
        <div class="panel">
            <h3>Beat</h3>
            <div class="beat-display">
                <div class="bpm-value" id="bpmValue">-- BPM</div>
                <div class="beat-indicator" id="beatIndicator"></div>
            </div>
            <div class="slider-group">
                <label>Sensitivity</label>
                <div class="slider-row">
                    <input type="range" id="beatSensitivity" min="0" max="100" value="50">
                    <span id="beatSensitivityValue">50%</span>
                </div>
            </div>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="beatFlashEnabled" checked>
                    Flash
                </label>
            </div>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="beatPulseEnabled">
                    Pulse
                </label>
            </div>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="beatRotationEnabled">
                    Beat-Rotation
                </label>
            </div>
            <div class="slider-group">
                <label>Rotation</label>
                <div class="slider-row">
                    <input type="range" id="rotationSpeed" min="0" max="100" value="20">
                    <span id="rotationSpeedValue">20%</span>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <h3>Camera</h3>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="cameraLocked">
                    Lock Position
                </label>
            </div>
            <button class="reset-btn" id="cameraResetBtn" style="margin-top:0;">‚åÇ Default Position</button>
            <button class="reset-btn" id="cameraOrbitBtn" style="margin-top:4px;">‚Üª Auto-Orbit</button>
            <div class="slider-group">
                <label>Focal Length (FOV)</label>
                <div class="slider-row">
                    <input type="range" id="cameraFov" min="20" max="120" value="50">
                    <span id="cameraFovValue">50¬∞</span>
                </div>
            </div>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="fovAudioLinked">
                    FOV ‚Üí Audio
                </label>
            </div>
            <div class="slider-group" id="fovAudioControl" style="opacity:0.5;">
                <label>FOV Reaction</label>
                <div class="slider-row">
                    <input type="range" id="fovAudioAmount" min="0" max="100" value="30" disabled>
                    <span id="fovAudioAmountValue">30%</span>
                </div>
            </div>
            <div class="slider-group">
                <label>Blur (Depth of Field)</label>
                <div class="slider-row">
                    <input type="range" id="cameraBlur" min="0" max="100" value="0">
                    <span id="cameraBlurValue">0%</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Canvas -->
    <canvas id="canvas"></canvas>
    <canvas id="aiOverlayCanvas"></canvas>
    
    <!-- Interval Overview Modal -->
    <div id="intervalModal" class="modal-overlay">
        <div class="modal-content modal-content-wide">
            <div class="modal-header">
                <h2>üéµ Interval Overview</h2>
                <div class="modal-header-controls">
                    <label>Set:</label>
                    <select id="intervalSetSelect" class="modal-select">
                        <!-- Dynamically populated -->
                    </select>
                </div>
                <span class="modal-close" id="intervalModalClose">‚úï</span>
            </div>
            <div class="modal-body modal-body-split">
                <div class="modal-left">
                    <p class="modal-description">Clara's synesthetic mapping: Click = Preview, Double-click = Load</p>
                    <div id="intervalGrid" class="interval-grid">
                        <!-- Dynamically populated -->
                    </div>
                </div>
                <div class="modal-right">
                    <div class="preview-section">
                        <h3 id="intervalPreviewTitle">Select an interval</h3>
                        <div id="intervalPreviewContainer" class="preview-3d-container">
                            <!-- 3D Renderer inserted here -->
                        </div>
                        <div class="preview-info">
                            <div class="legend-compact">
                                <span>‚óè Point</span>
                                <span>‚ñ¨ Small</span>
                                <span>‚¨≠ Oval</span>
                                <span>‚ï± Line</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <span class="hint">üí° Double-click an interval to load it into the main scene</span>
            </div>
        </div>
    </div>

    <!-- Import Map for ES Modules -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <!-- Main Entry Point -->
    <script type="module" src="js/main.js"></script>

    <!-- Panel Minimize & Fullscreen Script -->
    <script>
        // Panel minimize
        document.querySelectorAll('.panel h3').forEach(header => {
            header.addEventListener('click', (e) => {
                if (e.target.closest('.visibility-btn')) return;
                header.closest('.panel').classList.toggle('minimized');
            });
        });
        
        // NOTE: Model visibility wird in main.js gesteuert - KEIN doppelter Handler hier!
        
        // Fullscreen Toggle
        document.getElementById('fullscreenToggle').addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });
        
        // Keyboard Shortcut
        document.addEventListener('keydown', (e) => {
            if (e.key === 'f' || e.key === 'F') {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }
        });
    </script>
</body>
</html>
