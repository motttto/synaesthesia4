<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synesthesia - Harmonic Intervals</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Fullscreen Toggle -->
    <button id="fullscreenToggle" title="Fullscreen (F11)">‚õ∂</button>
    
    <!-- Collapse All Panels Toggle -->
    <button id="collapsePanelsToggle" title="Collapse/Expand All Panels (C)">‚ñº</button>
    
    <!-- DevTools Toggle (nur in Electron) -->
    <button id="devToolsToggle" title="Developer Tools" style="display:none;">üîß</button>
    
    <!-- Stream Status -->
    <div id="streamStatus" title="Click to copy MJPEG URL">localhost:9876</div>
    <div id="streamUrl" style="display:none;"></div>
    
    <!-- Vignette Overlay for Alex Mode -->
    <div id="vignetteOverlay"></div>
    
    <!-- TOP BAR: Spectrum, Master, Input EQ, Beat -->
    <div id="ui-top">
        <!-- Audio Spectrum -->
        <div class="panel panel-spectrum" id="panelSpectrum">
            <h3><span>üìä Spectrum</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="panel-content">
                <canvas id="spectrumCanvas" width="600" height="60"></canvas>
            </div>
        </div>
        
        <!-- Master -->
        <div class="panel panel-compact" id="panelMaster">
            <h3><span>Master</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="panel-content">
                <div class="master-row">
                    <div class="fader-mini">
                        <input type="range" id="masterGainTop" min="-60" max="12" step="0.5" value="0" orient="vertical">
                    </div>
                    <div class="master-info">
                        <div class="fader-value" id="gainValueTop">0 dB</div>
                        <div class="level-meter">
                            <div class="level-meter-fill" id="levelMeterTop"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Input EQ -->
        <div class="panel panel-compact" id="panelInputEQ">
            <h3><span>Input EQ</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="panel-content">
                <div class="eq-row">
                    <div class="eq-band-mini">
                        <input type="range" id="eqLowTop" min="-24" max="24" step="0.5" value="0" orient="vertical">
                        <span>Lo</span>
                    </div>
                    <div class="eq-band-mini">
                        <input type="range" id="eqMidTop" min="-24" max="24" step="0.5" value="0" orient="vertical">
                        <span>Mid</span>
                    </div>
                    <div class="eq-band-mini">
                        <input type="range" id="eqHighTop" min="-24" max="24" step="0.5" value="0" orient="vertical">
                        <span>Hi</span>
                    </div>
                    <button class="reset-btn-mini" id="eqResetTop" title="Reset EQ">‚Ü∫</button>
                </div>
            </div>
        </div>
        
        <!-- Beat -->
        <div class="panel panel-compact" id="panelBeat">
            <h3><span>Beat</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="panel-content">
                <div class="beat-row">
                    <div class="beat-indicator" id="beatIndicatorTop"></div>
                    <div class="bpm-value" id="bpmValueTop">-- BPM</div>
                </div>
                <div class="beat-options">
                    <label title="Flash on beat"><input type="checkbox" id="beatFlashTop" checked>‚ö°</label>
                    <label title="Pulse on beat"><input type="checkbox" id="beatPulseTop">üíì</label>
                    <label title="Rotate on beat"><input type="checkbox" id="beatRotateTop">üîÑ</label>
                </div>
            </div>
        </div>
    </div>
    
    <!-- LEFT COLUMN: Audio, MIDI, Notes, Percussion, Speech, Debug -->
    <div id="ui">
        <!-- Audio Source -->
        <div class="panel">
            <h3><span>Audio Source</span><span class="minimize-btn">‚ñº</span></h3>
            <select id="audioSourceSelect">
                <option value="">-- Select Device --</option>
            </select>
            <button id="startBtn">üé§ Start</button>
        </div>
        
        <!-- Audio Output -->
        <div class="panel">
            <h3><span>Audio Output</span><span class="minimize-btn">‚ñº</span></h3>
            <select id="audioOutputSelect">
                <option value="">-- Select Output --</option>
            </select>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="audioPassthroughEnabled">
                    Audio Passthrough
                </label>
            </div>
            <div class="slider-group" id="passthroughVolumeControl" style="opacity: 0.5;">
                <label>Volume</label>
                <div class="slider-row">
                    <input type="range" id="passthroughVolume" min="0" max="100" value="80" disabled>
                    <span id="passthroughVolumeValue">80%</span>
                </div>
            </div>
        </div>
        
        <!-- MIDI Controller -->
        <div class="panel">
            <h3><span>MIDI Controller</span><span class="minimize-btn">‚ñº</span></h3>
            <select id="midiDeviceSelect">
                <option value="">-- Select MIDI Device --</option>
            </select>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="midiEnabled">
                    Use MIDI as Input
                </label>
            </div>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="midiSynthEnabled">
                    Play MIDI Sound
                </label>
            </div>
            <div class="slider-group" id="midiSynthVolumeControl" style="opacity: 0.5;">
                <label>Synth Volume</label>
                <div class="slider-row">
                    <input type="range" id="midiSynthVolume" min="0" max="100" value="50" disabled>
                    <span id="midiSynthVolumeValue">50%</span>
                </div>
            </div>
            <div id="midiStatus" style="color:#666; font-size:11px; margin-top:8px;">MIDI not connected</div>
        </div>
        
        <!-- Pitch Detection -->
        <div class="panel">
            <h3><span>Pitch Detection</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="slider-group">
                <label>Reaction Speed</label>
                <div class="slider-row">
                    <input type="range" id="reactionSpeed" min="0" max="100" value="70">
                    <span id="reactionSpeedValue">70%</span>
                </div>
            </div>
            <div class="algo-grid" id="algoGrid">
                <button class="algo-btn active" data-algo="hps">HPS</button>
                <button class="algo-btn" data-algo="hpsWhitening">HPS+White</button>
                <button class="algo-btn" data-algo="peaks">Peaks</button>
                <button class="algo-btn" data-algo="autocorr">Autocorr</button>
                <button class="algo-btn" data-algo="cepstrum">Cepstrum</button>
                <button class="algo-btn" data-algo="yin">YIN</button>
            </div>
            <div class="algo-combine">
                <label>Combine:</label>
                <select id="algoCombineMode">
                    <option value="union">Union (all notes)</option>
                    <option value="intersection">Intersection</option>
                    <option value="voting">Voting (majority)</option>
                    <option value="strongest">Strongest confidence</option>
                </select>
            </div>
            <div class="algo-description" id="algoDescription">
                Click multiple algorithms for ensemble detection
            </div>
        </div>
        
        <!-- Detected Notes -->
        <div class="panel">
            <h3><span>Detected Notes</span><span class="minimize-btn">‚ñº</span></h3>
            <div id="detectedNotes">
                <span style="color:#666">Waiting for Audio...</span>
            </div>
            <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid #333;">
                <div id="intervalDisplay">-</div>
            </div>
        </div>
        
        <!-- Percussion -->
        <div class="panel">
            <h3><span>Percussion</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="panel-content">
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="percussionEnabled">
                        Detect Percussion
                    </label>
                </div>
                <div style="margin-top: 4px;">
                    <label style="font-size: 7px; color: #888;">Detection Model</label>
                    <select id="percussionPreset" style="margin-top: 2px;">
                        <option value="standard">Standard</option>
                        <option value="acoustic">Acoustic Kit</option>
                        <option value="electronic">Electronic</option>
                        <option value="live">Live/Noisy</option>
                        <option value="sensitive">Sensitive</option>
                        <option value="kickFocus">Kick Focus</option>
                        <option value="hiphop">Hip-Hop/Trap</option>
                        <option value="rock">Rock/Metal</option>
                    </select>
                </div>
                <div id="percussionPresetStatus" style="font-size: 7px; color: #666; margin-top: 2px; min-height: 12px;"></div>
                <div id="detectedPercussion">
                    <span style="color:#666">-</span>
                </div>
            </div>
        </div>
        
        <!-- Instrument Detection -->
        <div class="panel">
            <h3><span>üé∏ Instrument</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="instrumentEnabled">
                    Detect Instrument
                </label>
            </div>
            <div id="instrumentStatus" style="font-size: 7px; color: #888; margin-top: 2px;">‚èπ Inaktiv</div>
            <div style="margin-top: 6px; padding: 4px; background: #111; border-radius: 3px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span id="detectedInstrument" style="font-size: 12px; font-weight: bold; color: #4af;">-</span>
                    <div style="display: flex; align-items: center; gap: 4px;">
                        <span id="instrumentConfidence" style="font-size: 10px; color: #666;"></span>
                        <button id="instrumentRefreshBtn" class="reset-btn" style="margin: 0; padding: 2px 4px; font-size: 8px;" title="Re-analyze">üîÑ</button>
                    </div>
                </div>
                <div id="instrumentSecondary" style="font-size: 7px; color: #666; margin-top: 2px;">-</div>
            </div>
            <div class="interaction-mode" style="margin-top: 6px; padding-top: 6px; border-top: 1px solid #333;">
                <label>
                    <input type="checkbox" id="instrumentToPrompt">
                    ‚Üí AI Prompt
                </label>
            </div>
        </div>
        
        <!-- Speech Recognition -->
        <div class="panel">
            <h3><span>Speech üåê</span><span class="minimize-btn">‚ñº</span></h3>
            
            <!-- Backend Selection -->
            <div style="margin-bottom: 6px;">
                <label style="font-size: 7px; color: #888;">Backend</label>
                <select id="speechBackend" style="margin-top: 2px; width: 100%;">
                    <option value="webspeech">üåê Web Speech (Google Cloud)</option>
                    <option value="whisper-comfy">ü§ó Whisper (ComfyUI)</option>
                    <option value="whisper-local" selected>üíª Whisper Local (large-v3) ‚≠ê</option>
                </select>
            </div>
            
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="speechEnabled">
                    Enable Speech Recognition
                </label>
            </div>
            
            <!-- Language (for all backends) -->
            <select id="speechLang" style="margin-top:4px;">
                <option value="de-DE">Deutsch</option>
                <option value="en-US">English (US)</option>
                <option value="en-GB">English (UK)</option>
                <option value="fr-FR">Fran√ßais</option>
                <option value="es-ES">Espa√±ol</option>
            </select>
            
            <!-- Status -->
            <div id="speechStatus" style="color:#888; font-size:9px; margin-top:6px; padding:4px; background:#111; border-radius:3px;">
                ‚è∏ Off
            </div>
            
            <!-- Backend-specific info -->
            <div id="speechMicInfo" style="font-size:7px; color:#4f4; margin-top:3px; padding:3px; background:#112211; border-radius:2px;">
                ‚úÖ Nutzt App Audio-Eingang
            </div>
            
            <!-- Web Speech Settings -->
            <div id="speechWebSettings" style="display: none; margin-top: 4px; padding: 4px; background: #111; border-radius: 3px;">
                <div style="font-size: 7px; color: #666;">üåê Google Cloud - Continuous, requires internet</div>
            </div>
            
            <!-- Whisper ComfyUI Settings -->
            <div id="speechWhisperComfySettings" style="display: none; margin-top: 4px; padding: 4px; background: #111; border-radius: 3px;">
                <div style="font-size: 7px; color: #4af; margin-bottom: 4px;">ü§ó Whisper via ComfyUI - Uses app audio input</div>
                <div style="display: flex; gap: 4px; align-items: center;">
                    <span style="font-size: 7px; color: #888;">Model:</span>
                    <select id="whisperComfyModel" style="flex: 1; font-size: 8px;">
                        <option value="tiny">Tiny (fastest)</option>
                        <option value="base">Base (balanced)</option>
                        <option value="small">Small (better)</option>
                        <option value="medium">Medium (good)</option>
                        <option value="large-v3" selected>Large V3 (best) ‚≠ê</option>
                    </select>
                </div>
                <div id="whisperComfyStatus" style="font-size: 7px; color: #888; margin-top: 2px;">Requires ComfyUI + whisper node</div>
            </div>
            
            <!-- Whisper Local Settings -->
            <div id="speechWhisperLocalSettings" style="margin-top: 4px; padding: 4px; background: #112211; border: 1px solid #4f4; border-radius: 3px;">
                <div style="font-size: 7px; color: #4f4; margin-bottom: 4px;">üíª Local Whisper.cpp - Uses app audio input</div>
                <div style="display: flex; gap: 4px; align-items: center;">
                    <span style="font-size: 7px; color: #888;">Model:</span>
                    <select id="whisperLocalModel" style="flex: 1; font-size: 8px;">
                        <option value="tiny">Tiny (~75MB)</option>
                        <option value="base">Base (~142MB)</option>
                        <option value="small">Small (~466MB)</option>
                        <option value="medium">Medium (~1.5GB)</option>
                        <option value="large-v3" selected>Large V3 (~3GB) ‚≠ê</option>
                    </select>
                </div>
                <div style="display: flex; gap: 4px; margin-top: 4px;">
                    <button id="whisperCheckModels" class="reset-btn" style="flex: 1; font-size: 7px; padding: 3px;">üîç Check Models</button>
                    <button id="whisperTestLocal" class="reset-btn" style="flex: 1; font-size: 7px; padding: 3px;">üß™ Test</button>
                </div>
                <div id="whisperLocalStatus" style="font-size: 7px; color: #888; margin-top: 2px;">Checking whisper.cpp...</div>
                <div id="whisperAvailableModels" style="font-size: 6px; color: #666; margin-top: 2px; max-height: 40px; overflow-y: auto;"></div>
                <div style="font-size: 6px; color: #555; margin-top: 2px;">Install: brew install whisper-cpp</div>
            </div>
            
            <!-- Recognized Text -->
            <div id="speechText"></div>
        </div>
        
        <!-- Debug -->
        <div class="panel">
            <h3><span>Debug</span><span class="minimize-btn">‚ñº</span></h3>
            <div id="debugInfo"></div>
        </div>
    </div>
    
    <!-- BOTTOM BAR: Color Schema, Camera, 3D Model, Effects, AI Image -->
    <div id="ui-bottom">
        <!-- Color Schema -->
        <div class="panel" id="panelFarbschema">
            <h3>
                <span>Color Schema</span>
                <span class="header-icons">
                    <span class="visibility-btn active" id="colorVisibilityBtn" title="Enable/Disable Colors"></span>
                    <span class="minimize-btn">‚ñº</span>
                </span>
            </h3>
            <div class="panel-content">
                <div class="schema-selector">
                    <button class="schema-btn active" data-schema="clara">Clara</button>
                    <button class="schema-btn" data-schema="alex">Alex</button>
                    <button class="schema-btn" data-schema="both">Both</button>
                </div>
                
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="blendSchemas">
                        Blend Schemas
                    </label>
                </div>
                
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="alexDegreeColors">
                        Alex: Degree Colors (I-VII)
                    </label>
                </div>
                
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="alexGradient">
                        Alex: Gradients
                    </label>
                </div>
                
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="alexVignette">
                        Alex: Vignette
                    </label>
                </div>
                
                <div class="slider-group" id="blendControl" style="display:none;">
                    <label>Clara ‚Üî Alex</label>
                    <div class="slider-row">
                        <input type="range" id="blendSlider" min="0" max="100" value="50">
                        <span id="blendValue">50%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Camera -->
        <div class="panel" id="panelCamera">
            <h3><span>Camera</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="panel-content">
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="cameraLocked">
                        Lock Position
                    </label>
                </div>
                <button class="reset-btn" id="cameraResetBtn" style="margin-top:0;">‚åÇ Default Position</button>
                <button class="reset-btn" id="cameraOrbitBtn" style="margin-top:4px;">‚Üª Auto-Orbit</button>
                <div class="slider-group">
                    <label>Focal Length (FOV)</label>
                    <div class="slider-row">
                        <input type="range" id="cameraFov" min="20" max="120" value="50">
                        <span id="cameraFovValue">50¬∞</span>
                    </div>
                </div>
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="fovAudioLinked">
                        FOV ‚Üí Audio
                    </label>
                </div>
                <div class="slider-group" id="fovAudioControl" style="opacity:0.5;">
                    <label>FOV Reaction</label>
                    <div class="slider-row">
                        <input type="range" id="fovAudioAmount" min="0" max="100" value="30" disabled>
                        <span id="fovAudioAmountValue">30%</span>
                    </div>
                </div>
                <div class="slider-group">
                    <label>Blur (Depth of Field)</label>
                    <div class="slider-row">
                        <input type="range" id="cameraBlur" min="0" max="100" step="1" value="0">
                        <span id="cameraBlurValue">0%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 3D Model -->
        <div class="panel" id="panel3DModell">
            <h3>
                <span>3D Model</span>
                <span class="header-icons">
                    <span class="info-btn" id="intervalInfoBtn" title="Interval Overview">‚ÑπÔ∏è</span>
                    <span class="visibility-btn active" id="modelVisibilityBtn" title="Show/Hide Model"></span>
                    <span class="minimize-btn">‚ñº</span>
                </span>
            </h3>
            <div class="panel-content">
                <div class="model-set-row">
                    <select id="modelSetSelect">
                        <option value="">Standard (Legacy)</option>
                    </select>
                    <button id="scanModelSetsBtn" title="Scan for Model Sets">üîÑ</button>
                </div>
                <div id="modelSetStatus" style="font-size: 7px; color: #666; margin-bottom: 3px;"></div>
                <div class="slider-group">
                    <label>Scale</label>
                    <div class="slider-row">
                        <input type="range" id="scaleSlider" min="0.1" max="5" step="0.1" value="1">
                        <span id="scaleValue">1.0</span>
                    </div>
                </div>
                <div class="slider-group">
                    <label>Sensitivity</label>
                    <div class="slider-row">
                        <input type="range" id="sensitivitySlider" min="0.01" max="0.2" step="0.01" value="0.05">
                        <span id="sensitivityValue">0.05</span>
                    </div>
                </div>
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="morphingEnabled" checked>
                        Morphing
                    </label>
                </div>
                <div class="slider-group" id="morphDurationControl">
                    <label>Morph Duration</label>
                    <div class="slider-row">
                        <input type="range" id="morphDuration" min="100" max="1500" step="50" value="500">
                        <span id="morphDurationValue">500ms</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Video Texture -->
        <div class="panel" id="panelVideoTexture">
            <h3>
                <span>Video Texture</span>
                <span class="header-icons">
                    <span class="visibility-btn" id="videoVisibilityBtn" title="Enable/Disable Video Texture"></span>
                    <span class="minimize-btn">‚ñº</span>
                </span>
            </h3>
            <div class="panel-content">
                <!-- Load Videos -->
                <div class="video-load-row">
                    <label class="video-load-btn" title="Load Video Files">
                        üìÇ
                        <input type="file" id="videoFileInput" accept="video/*" multiple style="display:none;">
                    </label>
                    <span id="videoStatus" style="font-size: 7px; color: #666; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">üìπ No video</span>
                    <span id="videoLibraryCount" style="font-size: 7px; color: #888;">0 videos</span>
                </div>
                
                <!-- Video Library Thumbnails -->
                <div id="videoLibrary" class="video-library">
                    <span class="video-library-empty">Drop videos here or click üìÇ</span>
                </div>
                
                <!-- Playback Controls -->
                <div class="video-controls">
                    <button id="videoPrev" class="video-ctrl-btn" title="Previous">‚èÆ</button>
                    <button id="videoPlayPause" class="video-ctrl-btn" title="Play/Pause">‚ñ∂</button>
                    <button id="videoNext" class="video-ctrl-btn" title="Next">‚è≠</button>
                    <input type="range" id="videoProgress" min="0" max="100" value="0" class="video-progress">
                    <span id="videoTime" style="font-size: 7px; color: #888; min-width: 45px;">0:00</span>
                </div>
                
                <!-- Settings Row -->
                <div style="display: flex; gap: 8px; margin-top: 4px;">
                    <label class="interaction-mode" style="margin: 0; color: #fff;">
                        <input type="checkbox" id="videoLoop" checked>
                        <span style="font-size: 8px; color: #ccc;">Loop</span>
                    </label>
                    <label class="interaction-mode" style="margin: 0; color: #fff;">
                        <input type="checkbox" id="videoAutoCycle">
                        <span style="font-size: 8px; color: #ccc;">Auto-Cycle</span>
                    </label>
                </div>
                
                <!-- Speed -->
                <div class="slider-group">
                    <label>Speed</label>
                    <div class="slider-row">
                        <input type="range" id="videoRate" min="0.25" max="2" step="0.25" value="1">
                        <span id="videoRateValue">1.0x</span>
                    </div>
                </div>
                
                <!-- Blend Mode -->
                <div style="margin-top: 4px;">
                    <label style="font-size: 7px; color: #888;">Blend Mode</label>
                    <select id="videoBlendMode" style="margin-top: 2px;">
                        <option value="replace">Replace</option>
                        <option value="multiply">Multiply</option>
                        <option value="add">Add (Glow)</option>
                        <option value="overlay">Overlay</option>
                    </select>
                </div>
                
                <!-- Blend Amount -->
                <div class="slider-group">
                    <label>Intensity</label>
                    <div class="slider-row">
                        <input type="range" id="videoBlendAmount" min="0" max="100" value="100">
                        <span id="videoBlendValue">100%</span>
                    </div>
                </div>
                
                <!-- Displacement -->
                <div class="slider-group">
                    <label>Displacement</label>
                    <div class="slider-row">
                        <input type="range" id="videoDisplacement" min="-1000" max="1000" value="0">
                        <span id="videoDisplacementValue">0</span>
                    </div>
                </div>
                
                <!-- Audio-Reactive Displacement -->
                <div class="interaction-mode">
                    <label style="color: #ccc;">
                        <input type="checkbox" id="videoDisplacementAudio">
                        <span style="font-size: 8px;">Audio-Reactive</span>
                    </label>
                </div>
                
                <!-- Apply to All Models -->
                <div class="interaction-mode">
                    <label style="color: #ccc;">
                        <input type="checkbox" id="videoApplyToAll" checked>
                        <span style="font-size: 8px;">Apply to All Models</span>
                    </label>
                </div>
                
                <!-- Clear Button -->
                <button id="videoClearAll" class="reset-btn" style="margin-top: 4px; font-size: 7px;">üóë Clear All</button>
            </div>
        </div>
        
        <!-- Effects -->
        <div class="panel" id="panelEffekte">
            <h3><span>Effects</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="panel-content">
                <div class="effect-grid">
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="glitch">Glitch</button>
                        <div class="effect-slider" id="glitchSliderContainer">
                            <input type="range" id="glitchIntensity" min="0" max="100" value="50">
                            <div class="effect-slider-value"><span id="glitchIntensityValue">50%</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="pulse">Pulse</button>
                        <div class="effect-slider" id="pulseSliderContainer">
                            <input type="range" id="pulseIntensity" min="0" max="100" value="50">
                            <div class="effect-slider-value"><span id="pulseIntensityValue">50%</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="edge">Edge</button>
                        <div class="effect-slider" id="edgeSliderContainer">
                            <input type="range" id="edgeIntensity" min="0" max="100" value="50">
                            <div class="effect-slider-value">Intensity: <span id="edgeIntensityValue">50%</span></div>
                            <input type="range" id="edgeGlow" min="0" max="100" value="30" style="margin-top:2px;">
                            <div class="effect-slider-value">Glow: <span id="edgeGlowValue">30%</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="explode">Explode</button>
                        <div class="effect-slider" id="explodeSliderContainer">
                            <input type="range" id="explodeIntensity" min="0" max="100" value="50">
                            <div class="effect-slider-value">Intensity: <span id="explodeIntensityValue">50%</span></div>
                            <div style="margin-top: 6px; padding-top: 4px; border-top: 1px solid #333;">
                                <div class="effect-slider-value" style="font-size: 7px; color: #888;">üåä Oscillator</div>
                                <input type="range" id="explodeOscSpeed" min="0.5" max="10" step="0.5" value="2" style="margin-top:2px;">
                                <div class="effect-slider-value">Speed: <span id="explodeOscSpeedValue">2 Hz</span></div>
                                <input type="range" id="explodeOscAmount" min="0" max="100" value="50" style="margin-top:2px;">
                                <div class="effect-slider-value">Amount: <span id="explodeOscAmountValue">50%</span></div>
                            </div>
                            <div style="margin-top: 6px; padding-top: 4px; border-top: 1px solid #333;">
                                <label style="display:flex; align-items:center; gap:4px; font-size:8px; color:#ccc;">
                                    <input type="checkbox" id="explodeAudioEnabled">
                                    üéµ Audio-Reactive
                                </label>
                                <div id="explodeAudioControls" style="opacity: 0.5; margin-top: 4px;">
                                    <input type="range" id="explodeAudioAmount" min="0" max="100" value="50">
                                    <div class="effect-slider-value">Audio: <span id="explodeAudioAmountValue">50%</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="particles">‚ú® Particles</button>
                        <div class="effect-slider" id="particlesSliderContainer">
                            <input type="range" id="particlesIntensity" min="0" max="100" value="50">
                            <div class="effect-slider-value">Amount: <span id="particlesIntensityValue">50%</span></div>
                            <input type="range" id="particlesSize" min="0" max="100" value="30" style="margin-top:2px;">
                            <div class="effect-slider-value">Size: <span id="particlesSizeValue">30%</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="trails">‚òÅ Trails</button>
                        <div class="effect-slider" id="trailsSliderContainer">
                            <input type="range" id="trailsIntensity" min="0" max="100" value="70">
                            <div class="effect-slider-value">Afterglow: <span id="trailsIntensityValue">70%</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="fractal">üåÄ Fractal</button>
                        <div class="effect-slider" id="fractalSliderContainer">
                            <input type="range" id="fractalIntensity" min="0" max="100" value="50">
                            <div class="effect-slider-value">Intensity: <span id="fractalIntensityValue">50%</span></div>
                            <input type="range" id="fractalScale" min="1" max="100" value="30" style="margin-top:2px;">
                            <div class="effect-slider-value">Scale: <span id="fractalScaleValue">30%</span></div>
                            <input type="range" id="fractalSpeed" min="0" max="100" value="50" style="margin-top:2px;">
                            <div class="effect-slider-value">Speed: <span id="fractalSpeedValue">50%</span></div>
                            <input type="range" id="fractalOctaves" min="1" max="6" value="3" style="margin-top:2px;">
                            <div class="effect-slider-value">Complexity: <span id="fractalOctavesValue">3</span></div>
                        </div>
                    </div>
                    <div class="effect-item">
                        <button class="effect-btn" data-effect="kaleidoscope">üîÆ Kaleidoscope</button>
                        <div class="effect-slider" id="kaleidoscopeSliderContainer">
                            <input type="range" id="kaleidoscopeSegments" min="2" max="16" value="6">
                            <div class="effect-slider-value">Segments: <span id="kaleidoscopeSegmentsValue">6</span></div>
                            <input type="range" id="kaleidoscopeRotation" min="0" max="360" value="0" style="margin-top:2px;">
                            <div class="effect-slider-value">Rotation: <span id="kaleidoscopeRotationValue">0¬∞</span></div>
                            <input type="range" id="kaleidoscopeZoom" min="50" max="200" value="100" style="margin-top:2px;">
                            <div class="effect-slider-value">Zoom: <span id="kaleidoscopeZoomValue">100%</span></div>
                            <label style="display:flex; align-items:center; gap:4px; margin-top:4px; font-size:8px; color:#ccc;">
                                <input type="checkbox" id="kaleidoscopeAutoRotate">
                                Auto-Rotate
                            </label>
                            <input type="range" id="kaleidoscopeSpeed" min="0" max="100" value="30" style="margin-top:2px;">
                            <div class="effect-slider-value">Speed: <span id="kaleidoscopeSpeedValue">30%</span></div>
                        </div>
                    </div>
                </div>
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="audioScaleEnabled">
                        Audio ‚Üí Scale
                    </label>
                </div>
                <div class="slider-group" id="audioScaleControl" style="opacity:0.5;">
                    <label>Scale Amount</label>
                    <div class="slider-row">
                        <input type="range" id="audioScaleAmount" min="0" max="100" value="30" disabled>
                        <span id="audioScaleAmountValue">30%</span>
                    </div>
                </div>
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="gainLinked">
                        Audio ‚Üí Brightness
                    </label>
                </div>
                <div class="slider-group">
                    <label>Black Level</label>
                    <div class="slider-row">
                        <input type="range" id="blackLevel" min="0" max="50" value="0">
                        <span id="blackLevelValue">0</span>
                    </div>
                </div>
                <button class="reset-btn" id="resetAllBtn" title="Reset all effects & artifacts">‚ö†Ô∏è Reset All</button>
            </div>
        </div>
        
        <!-- Grid Floor Shader -->
        <div class="panel" id="panelGridFloor">
            <h3>
                <span>üåê Grid Floor</span>
                <span class="header-icons">
                    <span class="visibility-btn" id="gridVisibilityBtn" title="Enable/Disable Grid"></span>
                    <span class="minimize-btn">‚ñº</span>
                </span>
            </h3>
            <div class="panel-content">
                <!-- Grid Size -->
                <div class="slider-group">
                    <label>Grid X</label>
                    <div class="slider-row">
                        <input type="range" id="gridSizeX" min="10" max="100" value="40">
                        <span id="gridSizeXValue">40</span>
                    </div>
                </div>
                <div class="slider-group">
                    <label>Grid Y</label>
                    <div class="slider-row">
                        <input type="range" id="gridSizeY" min="10" max="100" value="40">
                        <span id="gridSizeYValue">40</span>
                    </div>
                </div>
                
                <!-- Spacing -->
                <div class="slider-group">
                    <label>Spacing</label>
                    <div class="slider-row">
                        <input type="range" id="gridSpacing" min="0.1" max="2" step="0.1" value="0.5">
                        <span id="gridSpacingValue">0.5</span>
                    </div>
                </div>
                
                <!-- Position Y -->
                <div class="slider-group">
                    <label>Height</label>
                    <div class="slider-row">
                        <input type="range" id="gridPositionY" min="-10" max="2" step="0.5" value="-3">
                        <span id="gridPositionYValue">-3</span>
                    </div>
                </div>
                
                <!-- Line Width -->
                <div class="slider-group">
                    <label>Line Width</label>
                    <div class="slider-row">
                        <input type="range" id="gridLineWidth" min="0.5" max="5" step="0.5" value="1.5">
                        <span id="gridLineWidthValue">1.5</span>
                    </div>
                </div>
                
                <!-- Glow -->
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="gridGlowEnabled" checked>
                        Glow
                    </label>
                </div>
                <div class="slider-group">
                    <label>Glow Intensity</label>
                    <div class="slider-row">
                        <input type="range" id="gridGlowIntensity" min="0" max="2" step="0.1" value="0.8">
                        <span id="gridGlowIntensityValue">0.8</span>
                    </div>
                </div>
                
                <!-- Audio Reaktiv -->
                <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid #333;">
                    <div style="font-size: 7px; color: #888; margin-bottom: 4px;">üéµ Audio Reactive</div>
                    <div class="interaction-mode">
                        <label>
                            <input type="checkbox" id="gridAudioEnabled" checked>
                            EQ ‚Üí Waves
                        </label>
                    </div>
                    <div class="slider-group">
                        <label>Wave Height</label>
                        <div class="slider-row">
                            <input type="range" id="gridWaveHeight" min="0" max="2" step="0.1" value="0.5">
                            <span id="gridWaveHeightValue">0.5</span>
                        </div>
                    </div>
                    <div class="slider-group">
                        <label>Wave Speed</label>
                        <div class="slider-row">
                            <input type="range" id="gridWaveSpeed" min="0.5" max="5" step="0.5" value="2">
                            <span id="gridWaveSpeedValue">2.0</span>
                        </div>
                    </div>
                    <div class="slider-group">
                        <label>Audio Intensity</label>
                        <div class="slider-row">
                            <input type="range" id="gridAudioIntensity" min="0" max="3" step="0.1" value="1">
                            <span id="gridAudioIntensityValue">1.0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Color -->
                <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid #333;">
                    <div class="interaction-mode">
                        <label>
                            <input type="checkbox" id="gridUseSchemaColor" checked>
                            Use Color Schema
                        </label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 6px; margin-top: 4px;">
                        <label style="font-size: 7px; color: #888;">Custom:</label>
                        <input type="color" id="gridColor" value="#4488ff" style="width: 30px; height: 20px; padding: 0; border: none; cursor: pointer;">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- DMX Output -->
        <div class="panel" id="panelDMX">
            <h3>
                <span>üí° DMX Output</span>
                <span class="header-icons">
                    <span class="visibility-btn" id="dmxVisibilityBtn" title="Enable/Disable DMX"></span>
                    <span class="minimize-btn">‚ñº</span>
                </span>
            </h3>
            <div class="panel-content">
                <!-- Connection -->
                <div style="margin-bottom: 8px;">
                    <label style="font-size: 7px; color: #888;">Protocol</label>
                    <select id="dmxProtocol" style="margin-top: 2px;">
                        <option value="artnet">Art-Net (UDP)</option>
                        <option value="sacn">sACN / E1.31</option>
                        <option value="serial">USB Serial (Enttec)</option>
                    </select>
                </div>
                
                <!-- Art-Net Settings -->
                <div id="dmxArtnetSettings">
                    <div class="slider-group">
                        <label>Host IP</label>
                        <input type="text" id="dmxArtnetHost" value="127.0.0.1" style="width: 100%; font-size: 10px; padding: 4px;">
                    </div>
                    <div class="slider-group">
                        <label>Universe</label>
                        <div class="slider-row">
                            <input type="number" id="dmxUniverse" min="0" max="15" value="0" style="width: 60px;">
                        </div>
                    </div>
                </div>
                
                <!-- Serial Settings (hidden by default) -->
                <div id="dmxSerialSettings" style="display: none;">
                    <label style="font-size: 7px; color: #888;">Serial Port</label>
                    <select id="dmxSerialPort" style="margin-top: 2px;">
                        <option value="">-- Select Port --</option>
                    </select>
                </div>
                
                <!-- Connect Button -->
                <button id="dmxConnectBtn" class="reset-btn" style="margin-top: 8px; width: 100%;">üîå Connect</button>
                <div id="dmxStatus" style="font-size: 7px; color: #888; margin-top: 4px;">‚èπ Not connected</div>
                
                <!-- Master Controls -->
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333;">
                    <div class="slider-group">
                        <label>Master Dimmer</label>
                        <div class="slider-row">
                            <input type="range" id="dmxMasterDimmer" min="0" max="255" value="255">
                            <span id="dmxMasterValue">255</span>
                        </div>
                    </div>
                    <button id="dmxBlackout" class="reset-btn" style="width: 100%; background: #300;">üö´ Blackout</button>
                </div>
                
                <!-- Color Source -->
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333;">
                    <label style="font-size: 7px; color: #888;">Color Source</label>
                    <select id="dmxColorSource" style="margin-top: 2px;">
                        <option value="clara">Clara (Note Colors)</option>
                        <option value="alex">Alex (Mode Colors)</option>
                        <option value="manual">Manual</option>
                    </select>
                </div>
                
                <!-- Audio Mapping -->
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333;">
                    <div style="font-size: 7px; color: #888; margin-bottom: 4px;">üéµ Audio Mapping</div>
                    <div class="interaction-mode">
                        <label>
                            <input type="checkbox" id="dmxAudioToDimmer">
                            Audio ‚Üí Dimmer
                        </label>
                    </div>
                    <div class="interaction-mode">
                        <label>
                            <input type="checkbox" id="dmxBeatToStrobe">
                            Beat ‚Üí Strobe
                        </label>
                    </div>
                </div>
                
                <!-- Fixtures -->
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                        <span style="font-size: 7px; color: #888;">Fixtures</span>
                        <button id="dmxAddFixture" class="reset-btn" style="padding: 2px 6px; font-size: 8px;">‚ûï Add</button>
                    </div>
                    <div id="dmxFixtureList" style="max-height: 100px; overflow-y: auto; background: #111; border-radius: 3px; padding: 4px;">
                        <div style="color:#666; font-size:9px;">No fixtures added</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Camera Input (USB/Webcam) -->
        <div class="panel" id="panelCameraInput">
            <h3>
                <span>üì∑ Camera Input</span>
                <span class="header-icons">
                    <span class="visibility-btn" id="cameraInputVisibilityBtn" title="Enable/Disable Camera"></span>
                    <span class="minimize-btn">‚ñº</span>
                </span>
            </h3>
            <div class="panel-content">
                <!-- Camera Selection -->
                <div style="display: flex; gap: 4px; margin-bottom: 4px;">
                    <select id="cameraInputSelect" style="flex: 1;">
                        <option value="">-- Select Camera --</option>
                    </select>
                    <button id="cameraInputRefresh" class="reset-btn" style="margin: 0; padding: 4px 6px;" title="Refresh Devices">üîÑ</button>
                </div>
                <div id="cameraInputStatus" style="font-size: 7px; color: #666; margin-bottom: 4px;">‚ö´ Disconnected</div>
                
                <!-- Opacity -->
                <div class="slider-group">
                    <label>Camera Opacity</label>
                    <div class="slider-row">
                        <input type="range" id="cameraInputOpacity" min="0" max="100" value="50">
                        <span id="cameraInputOpacityValue">50%</span>
                    </div>
                </div>
                
                <!-- Blend Mode -->
                <div style="margin-top: 4px;">
                    <label style="font-size: 7px; color: #888;">Blend Mode</label>
                    <select id="cameraInputBlendMode" style="margin-top: 2px;">
                        <option value="normal">Normal</option>
                        <option value="overlay">Overlay</option>
                        <option value="multiply">Multiply</option>
                        <option value="screen">Screen</option>
                        <option value="add">Add (Glow)</option>
                        <option value="difference">Difference</option>
                        <option value="hard-light">Hard Light</option>
                        <option value="soft-light">Soft Light</option>
                    </select>
                </div>
                
                <!-- Audio-Reactive -->
                <div class="interaction-mode" style="margin-top: 6px;">
                    <label>
                        <input type="checkbox" id="cameraInputAudioReactive">
                        Audio ‚Üí Opacity
                    </label>
                </div>
                
                <!-- Audio Range -->
                <div id="cameraInputAudioRange" style="margin-top: 4px; padding: 4px; background: #111; border-radius: 3px;">
                    <div class="slider-group" style="margin-bottom: 2px;">
                        <label style="font-size: 7px;">Min Opacity</label>
                        <div class="slider-row">
                            <input type="range" id="cameraInputAudioMin" min="0" max="100" value="0">
                            <span id="cameraInputAudioMinValue">0%</span>
                        </div>
                    </div>
                    <div class="slider-group">
                        <label style="font-size: 7px;">Max Opacity</label>
                        <div class="slider-row">
                            <input type="range" id="cameraInputAudioMax" min="0" max="100" value="100">
                            <span id="cameraInputAudioMaxValue">100%</span>
                        </div>
                    </div>
                </div>
                
                <!-- Mirror -->
                <div class="interaction-mode" style="margin-top: 4px;">
                    <label>
                        <input type="checkbox" id="cameraInputMirror">
                        Mirror
                    </label>
                </div>
                
                <!-- Use as 3D Texture -->
                <div class="interaction-mode" style="margin-top: 4px;">
                    <label>
                        <input type="checkbox" id="cameraInputAsTexture">
                        Use as 3D Texture
                    </label>
                </div>
                
                <!-- Apply to All Models -->
                <div class="interaction-mode" style="margin-top: 2px; margin-left: 16px;">
                    <label style="color: #ccc;">
                        <input type="checkbox" id="cameraInputApplyToAll" checked>
                        <span style="font-size: 8px;">Apply to All Models</span>
                    </label>
                </div>
                
                <!-- Skeleton Tracking -->
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333;">
                    <label style="font-size: 7px; color: #888;">ü¶¥ Body/Face/Hand Tracking</label>
                    <div id="skeletonStatus" style="font-size: 7px; color: #666; margin-top: 2px;">‚ö´ No models active</div>
                    
                    <!-- Body Tracking -->
                    <div id="skeletonModels" style="margin-top: 4px; padding: 4px; background: #111; border-radius: 3px;">
                        <div style="font-size: 7px; color: #666; margin-bottom: 3px;">Body Tracking</div>
                        <!-- MediaPipe -->
                        <div style="display: flex; align-items: center; gap: 4px; margin-bottom: 3px;">
                            <input type="checkbox" id="skeleton-mediapipe" style="margin: 0;">
                            <input type="color" id="skeleton-color-mediapipe" value="#00ff00" style="width: 18px; height: 14px; padding: 0; border: none;">
                            <label for="skeleton-mediapipe" style="font-size: 8px; color: #ccc; flex: 1;">MediaPipe (33pt)</label>
                            <span id="skeleton-status-mediapipe" style="font-size: 10px;"></span>
                        </div>
                        <!-- MoveNet Lightning -->
                        <div style="display: flex; align-items: center; gap: 4px; margin-bottom: 3px;">
                            <input type="checkbox" id="skeleton-movenet-lightning" style="margin: 0;">
                            <input type="color" id="skeleton-color-movenet-lightning" value="#ff00ff" style="width: 18px; height: 14px; padding: 0; border: none;">
                            <label for="skeleton-movenet-lightning" style="font-size: 8px; color: #ccc; flex: 1;">MoveNet Fast (17pt)</label>
                            <span id="skeleton-status-movenet-lightning" style="font-size: 10px;"></span>
                        </div>
                        <!-- MoveNet Thunder -->
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <input type="checkbox" id="skeleton-movenet-thunder" style="margin: 0;">
                            <input type="color" id="skeleton-color-movenet-thunder" value="#00ffff" style="width: 18px; height: 14px; padding: 0; border: none;">
                            <label for="skeleton-movenet-thunder" style="font-size: 8px; color: #ccc; flex: 1;">MoveNet Accurate (17pt)</label>
                            <span id="skeleton-status-movenet-thunder" style="font-size: 10px;"></span>
                        </div>
                    </div>
                    
                    <!-- Face & Hand Tracking -->
                    <div style="margin-top: 4px; padding: 4px; background: #111; border-radius: 3px;">
                        <div style="font-size: 7px; color: #666; margin-bottom: 3px;">Face & Hands</div>
                        <!-- Face -->
                        <div style="display: flex; align-items: center; gap: 4px; margin-bottom: 3px;">
                            <input type="checkbox" id="skeleton-face" style="margin: 0;">
                            <input type="color" id="skeleton-color-face" value="#ffff00" style="width: 18px; height: 14px; padding: 0; border: none;">
                            <label for="skeleton-face" style="font-size: 8px; color: #ccc; flex: 1;">üòä Face Mesh (468pt)</label>
                            <span id="skeleton-status-face" style="font-size: 10px;"></span>
                        </div>
                        <!-- Hands -->
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <input type="checkbox" id="skeleton-hands" style="margin: 0;">
                            <input type="color" id="skeleton-color-hands" value="#ff8800" style="width: 18px; height: 14px; padding: 0; border: none;">
                            <label for="skeleton-hands" style="font-size: 8px; color: #ccc; flex: 1;">‚úã Hands (21pt √ó 2)</label>
                            <span id="skeleton-status-hands" style="font-size: 10px;"></span>
                        </div>
                        <!-- Object Detection (NEU) -->
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <input type="checkbox" id="skeleton-objects" style="margin: 0;">
                            <input type="color" id="skeleton-color-objects" value="#ff0066" style="width: 18px; height: 14px; padding: 0; border: none;">
                            <label for="skeleton-objects" style="font-size: 8px; color: #ccc; flex: 1;">üì¶ Objects (COCO-SSD)</label>
                            <span id="skeleton-status-objects" style="font-size: 10px;"></span>
                        </div>
                    </div>
                    
                    <!-- Display Options -->
                    <div id="skeletonOptions" style="margin-top: 4px; padding: 4px; background: #111; border-radius: 3px;">
                        <div class="slider-group" style="margin-bottom: 4px;">
                            <label style="font-size: 7px;">Tracking Opacity</label>
                            <div class="slider-row">
                                <input type="range" id="skeletonOpacity" min="0" max="100" value="100">
                                <span id="skeletonOpacityValue" style="font-size: 8px;">100%</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <label class="interaction-mode" style="margin: 0;">
                                <input type="checkbox" id="skeletonShowLines" checked>
                                <span style="font-size: 8px; color: #ccc;">Lines</span>
                            </label>
                            <label class="interaction-mode" style="margin: 0;">
                                <input type="checkbox" id="skeletonShowPoints" checked>
                                <span style="font-size: 8px; color: #ccc;">Points</span>
                            </label>
                            <label class="interaction-mode" style="margin: 0;">
                                <input type="checkbox" id="skeletonShowLabels">
                                <span style="font-size: 8px; color: #ccc;">Labels</span>
                            </label>
                        </div>
                        <div class="slider-group" style="margin-top: 4px;">
                            <label style="font-size: 7px;">Line Width</label>
                            <div class="slider-row">
                                <input type="range" id="skeletonLineWidth" min="1" max="10" value="3">
                                <span id="skeletonLineWidthValue" style="font-size: 8px;">3px</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 3D Model Mapping -->
                    <div style="margin-top: 4px; padding: 4px; background: #181818; border-radius: 3px; border: 1px solid #333;">
                        <div class="interaction-mode" style="margin: 0;">
                            <label>
                                <input type="checkbox" id="modelMappingEnabled">
                                <span style="font-size: 8px; color: #fff;">üéØ Map 3D Model to Tracking</span>
                            </label>
                        </div>
                        <div id="modelMappingControls" style="display: none; margin-top: 6px;">
                            <div style="margin-bottom: 4px;">
                                <label style="font-size: 7px; color: #888;">Target</label>
                                <select id="modelMappingTarget" style="margin-top: 2px; width: 100%;">
                                    <option value="none">-- Select --</option>
                                    <option value="nose">üëÉ Nose</option>
                                    <option value="face_center">üòä Face Center</option>
                                    <option value="left_hand">ü§ö Left Hand</option>
                                    <option value="right_hand">‚úã Right Hand</option>
                                    <option value="between_hands">üôå Between Hands</option>
                                </select>
                            </div>
                            <div class="slider-group" style="margin-bottom: 4px;">
                                <label style="font-size: 7px;">Smoothing</label>
                                <div class="slider-row">
                                    <input type="range" id="modelMappingSmoothing" min="0" max="95" value="30">
                                    <span id="modelMappingSmoothingValue" style="font-size: 8px;">30%</span>
                                </div>
                            </div>
                            <div class="slider-group">
                                <label style="font-size: 7px;">Scale</label>
                                <div class="slider-row">
                                    <input type="range" id="modelMappingScale" min="10" max="300" value="100">
                                    <span id="modelMappingScaleValue" style="font-size: 8px;">100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Prompt Debug -->
        <div class="panel" id="panelAiPromptDebug">
            <h3><span>üîç AI Prompt</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="panel-content">
                <!-- Wordcloud -->
                <div style="margin-bottom: 6px; padding: 6px; background: #0a0a0a; border-radius: 4px; border: 1px solid #333;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                        <span style="font-size: 7px; color: #888;">‚òÅÔ∏è Word Cloud</span>
                        <button id="wordcloudClear" class="reset-btn" style="margin: 0; padding: 2px 6px; font-size: 7px;">üóë Clear</button>
                    </div>
                    <div id="wordcloudContainer" style="min-height: 60px; max-height: 120px; overflow-y: auto; display: flex; flex-wrap: wrap; gap: 4px; align-items: center; justify-content: center; padding: 4px;">
                        <span style="color: #444; font-size: 8px; font-style: italic;">Warte auf Speech...</span>
                    </div>
                </div>
                
                <!-- Mini AI Preview -->
                <div style="margin-bottom: 6px; padding: 6px; background: #0a0a12; border-radius: 4px; border: 1px solid #335;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                        <span style="font-size: 7px; color: #88f;">üñºÔ∏è Mini AI (128√ó128)</span>
                        <div style="display: flex; gap: 4px;">
                            <button id="miniAiGenerate" class="reset-btn" style="margin: 0; padding: 2px 6px; font-size: 7px; background: linear-gradient(135deg, #448, #226);">üé®</button>
                            <button id="miniAiAuto" class="reset-btn" style="margin: 0; padding: 2px 6px; font-size: 7px;" title="Auto-Generate">‚ö°</button>
                        </div>
                    </div>
                    <div style="display: flex; gap: 6px; align-items: flex-start;">
                        <div id="miniAiPreview" style="width: 80px; height: 80px; background: #111; border: 1px solid #333; border-radius: 4px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                            <span style="color: #444; font-size: 7px;">-</span>
                        </div>
                        <div style="flex: 1; font-size: 7px;">
                            <div id="miniAiStatus" style="color: #666; margin-bottom: 4px;">Bereit</div>
                            <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                                <button id="miniAiToMain" class="reset-btn" style="margin: 0; padding: 2px 4px; font-size: 6px;" title="Use as main">‚ÜóÔ∏è Main</button>
                                <button id="miniAiToPrompt" class="reset-btn" style="margin: 0; padding: 2px 4px; font-size: 6px;" title="Copy seed">üé≤ Seed</button>
                            </div>
                            <div id="miniAiTime" style="color: #555; margin-top: 4px; font-size: 6px;">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- Speech Buffer Timeout Slider -->
                <div class="slider-group" style="margin-bottom: 6px; padding-bottom: 6px; border-bottom: 1px solid #333;">
                    <label style="font-size: 7px;">Speech Buffer Timeout</label>
                    <div class="slider-row">
                        <input type="range" id="speechBufferTimeout" min="1000" max="10000" step="500" value="3000">
                        <span id="speechBufferTimeoutValue" style="font-size: 8px;">3.0s</span>
                    </div>
                    <div style="font-size: 6px; color: #666;">Auto-clear nach Stille</div>
                </div>
                
                <!-- Prompt Pipeline Visualization -->
                <div style="background: #0a0a0a; border: 1px solid #333; border-radius: 4px; padding: 6px; margin-bottom: 6px;">
                    
                    <!-- Step 1: Input -->
                    <div style="display: flex; gap: 4px; align-items: flex-start; margin-bottom: 4px;">
                        <span style="font-size: 7px; color: #888; min-width: 70px;">üé§ Input:</span>
                        <div id="aiDebugBasePrompt" style="flex: 1; font-size: 8px; color: #ff8; padding: 4px; background: #111; border-radius: 3px; min-height: 18px; word-break: break-all; max-height: 50px; overflow-y: auto;">-</div>
                        <button id="aiClearSpeechBuffer" class="reset-btn" style="margin: 0; padding: 3px 5px; font-size: 7px;" title="Clear">üóë</button>
                    </div>
                    
                    <!-- Step 2: Translation (only visible when translated) -->
                    <div id="aiTranslationRow" style="display: none; gap: 4px; align-items: flex-start; margin-bottom: 4px; padding-left: 12px; border-left: 2px solid #4af;">
                        <span style="font-size: 7px; color: #4af; min-width: 58px;">üåê ‚Üí EN:</span>
                        <div id="aiDebugTranslatedPrompt" style="flex: 1; font-size: 8px; color: #4af; padding: 4px; background: #0a1520; border-radius: 3px; min-height: 18px; word-break: break-all;">-</div>
                    </div>
                    
                    <!-- Step 3: Instrument -->
                    <div style="display: flex; gap: 4px; align-items: center; margin-bottom: 4px; padding-left: 12px; opacity: 0.8;">
                        <span style="font-size: 7px; color: #888; min-width: 58px;">üé∏ + Instr:</span>
                        <div id="aiDebugInstrument" style="flex: 1; font-size: 7px; color: #8af; padding: 2px 4px; background: #111; border-radius: 2px;">(none)</div>
                    </div>
                    
                    <!-- Step 4: Modifiers -->
                    <div style="display: flex; gap: 4px; align-items: flex-start; padding-left: 12px; opacity: 0.8;">
                        <span style="font-size: 7px; color: #888; min-width: 58px;">üé® + Mods:</span>
                        <div id="aiDebugModifiers" style="flex: 1; font-size: 7px; color: #a8f; padding: 2px 4px; background: #111; border-radius: 2px; max-height: 30px; overflow-y: auto; word-break: break-all;">(none)</div>
                    </div>
                    
                </div>
                
                <!-- Final Output -->
                <div style="font-size: 7px; color: #4f4; margin-bottom: 2px; font-weight: bold;">üì§ Final ‚Üí ComfyUI:</div>
                <div id="aiDebugFinalPrompt" style="font-size: 8px; color: #4f4; padding: 6px; background: #0a1a0a; border: 1px solid #4f4; border-radius: 3px; min-height: 30px; word-break: break-all; font-family: monospace;">-</div>
                
                <div style="display: flex; gap: 4px; margin-top: 6px;">
                    <button id="aiDebugCopyPrompt" class="reset-btn" style="flex: 1; font-size: 7px; padding: 3px;">üìã Copy</button>
                    <button id="aiDebugRefresh" class="reset-btn" style="flex: 1; font-size: 7px; padding: 3px;">üîÑ</button>
                    <button id="aiRegenerateFromDebug" class="reset-btn" style="flex: 1; font-size: 7px; padding: 3px; background: linear-gradient(135deg, #4a4, #282);" title="Generate image with this prompt">üé® Generate</button>
                </div>
                
                <div style="font-size: 6px; color: #666; margin-top: 4px;">Last update: <span id="aiDebugTimestamp">-</span></div>
            </div>
        </div>
        
        <!-- Translation Settings Panel -->
        <div class="panel" id="panelTranslation">
            <h3><span>üåê Translation</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="panel-content">
                
                <!-- Master Toggle -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 1px solid #333;">
                    <span style="font-size: 8px; color: #fff;">Auto-Translate (DE‚ÜíEN)</span>
                    <label class="toggle-switch" style="transform: scale(0.8);">
                        <input type="checkbox" id="translateEnabled" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                
                <!-- Translation Methods -->
                <div style="font-size: 7px; color: #888; margin-bottom: 4px;">üõ† Methoden:</div>
                
                <div style="display: flex; flex-direction: column; gap: 4px; padding-left: 8px; margin-bottom: 8px;">
                    <!-- Dictionary -->
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 7px; color: #aaa;" title="Direktes W√∂rterbuch-Lookup">üìñ Dictionary</span>
                        <label class="toggle-switch" style="transform: scale(0.7);">
                            <input type="checkbox" id="translateDictionary" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <!-- Compound Words -->
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 7px; color: #aaa;" title="Zusammengesetzte W√∂rter zerlegen (Stromausfall ‚Üí Strom+Ausfall)">üîó Compound Words</span>
                        <label class="toggle-switch" style="transform: scale(0.7);">
                            <input type="checkbox" id="translateCompound" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <!-- Stemming -->
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 7px; color: #aaa;" title="Deutsche Endungen entfernen (gefahren ‚Üí gefahr)">‚úÇÔ∏è Stemming</span>
                        <label class="toggle-switch" style="transform: scale(0.7);">
                            <input type="checkbox" id="translateStemming" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <!-- Fuzzy Matching -->
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 7px; color: #aaa;" title="√Ñhnliche W√∂rter finden (Gevar ‚Üí Gefahr)">üîç Fuzzy Match</span>
                        <label class="toggle-switch" style="transform: scale(0.7);">
                            <input type="checkbox" id="translateFuzzy" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <!-- Skip German -->
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 7px; color: #aaa;" title="Nicht-√ºbersetzbare deutsche W√∂rter √ºberspringen">üö´ Skip Unknown DE</span>
                        <label class="toggle-switch" style="transform: scale(0.7);">
                            <input type="checkbox" id="translateSkipGerman" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <!-- Fuzzy Distance Slider -->
                <div class="slider-group" style="margin-bottom: 6px;">
                    <label style="font-size: 7px;">üîç Fuzzy Max Distance</label>
                    <div class="slider-row">
                        <input type="range" id="fuzzyMaxDistance" min="0" max="4" step="1" value="0">
                        <span id="fuzzyMaxDistanceValue" style="font-size: 8px;">auto</span>
                    </div>
                    <div style="font-size: 6px; color: #666;">0=auto, 1-4=fest</div>
                </div>
                
                <!-- API Translation (optional) -->
                <div style="margin-top: 8px; padding-top: 6px; border-top: 1px solid #333;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                        <span style="font-size: 7px; color: #888;">üåê LibreTranslate API</span>
                        <label class="toggle-switch" style="transform: scale(0.7);">
                            <input type="checkbox" id="translateUseApi">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <input type="text" id="translateApiUrl" placeholder="http://localhost:5000/translate" 
                           style="width: 100%; font-size: 7px; padding: 4px; background: #111; border: 1px solid #333; border-radius: 3px; color: #888;">
                </div>
                
                <!-- Stats -->
                <div style="margin-top: 8px; padding-top: 6px; border-top: 1px solid #333; font-size: 6px; color: #666;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>üìñ Dictionary:</span>
                        <span id="translateDictCount">~200 W√∂rter</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>üö´ Stopwords:</span>
                        <span id="translateStopCount">~150 W√∂rter</span>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- Song Recognition & Lyrics -->
        <div class="panel" id="panelSongRecognition">
            <h3><span>üéµ Song Recognition</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="panel-content">
                
                <!-- Status & Controls -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span id="songRecognitionStatus" style="font-size: 8px; color: #888;">Ready</span>
                    <div style="display: flex; gap: 4px;">
                        <button id="songRecognizeBtn" class="reset-btn" style="padding: 4px 8px; font-size: 7px; background: linear-gradient(135deg, #448, #226);">üéôÔ∏è Recognize</button>
                        <button id="clearSongBtn" class="reset-btn" style="padding: 4px 8px; font-size: 7px;">üóë</button>
                    </div>
                </div>
                
                <!-- Current Song Info -->
                <div id="songInfo" style="padding: 8px; background: #111; border-radius: 4px; margin-bottom: 8px; min-height: 40px;">
                    <span style="color: #666;">No song detected</span>
                </div>
                
                <!-- Manual Song Input -->
                <div style="display: flex; gap: 4px; margin-bottom: 8px;">
                    <input type="text" id="manualArtist" placeholder="Artist" 
                           style="flex: 1; font-size: 8px; padding: 4px; background: #111; border: 1px solid #333; border-radius: 3px; color: #aaa;">
                    <input type="text" id="manualTitle" placeholder="Song Title" 
                           style="flex: 1; font-size: 8px; padding: 4px; background: #111; border: 1px solid #333; border-radius: 3px; color: #aaa;">
                    <button id="manualFetchBtn" class="reset-btn" style="padding: 4px 8px; font-size: 7px;">üìù</button>
                </div>
                
                <!-- Current Lyric Line (large display) -->
                <div style="padding: 12px; background: linear-gradient(135deg, #1a1a2e, #16213e); border-radius: 6px; margin-bottom: 8px; text-align: center; min-height: 50px; display: flex; align-items: center; justify-content: center;">
                    <span id="currentLyricLine" style="font-size: 14px; color: #fff; font-weight: bold; transition: opacity 0.3s;">-</span>
                </div>
                
                <!-- Lyrics Controls -->
                <div style="display: flex; gap: 4px; margin-bottom: 8px;">
                    <button id="fetchLyricsBtn" class="reset-btn" style="flex: 1; padding: 4px; font-size: 7px;">üìù Fetch Lyrics</button>
                    <button id="startLyricsScroll" class="reset-btn" style="flex: 1; padding: 4px; font-size: 7px; background: linear-gradient(135deg, #484, #262);">‚ñ∂Ô∏è Start</button>
                </div>
                
                <!-- Lyrics Container (scrollable) -->
                <div id="lyricsContainer" style="max-height: 120px; overflow-y: auto; background: #0a0a0a; border: 1px solid #333; border-radius: 4px; padding: 4px; margin-bottom: 8px; font-size: 8px; color: #888;">
                    <!-- Lyrics lines will be inserted here -->
                </div>
                
                <!-- Settings -->
                <div style="border-top: 1px solid #333; padding-top: 8px;">
                    
                    <!-- Use Lyrics as Prompt -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                        <span style="font-size: 7px; color: #aaa;" title="Sendet Lyrics-Zeilen als AI Prompt">üé® Lyrics ‚Üí AI Prompt</span>
                        <label class="toggle-switch" style="transform: scale(0.7);">
                            <input type="checkbox" id="songUseLyricsAsPrompt">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <!-- Auto Recognize -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                        <span style="font-size: 7px; color: #aaa;">üîÑ Auto-Recognize</span>
                        <label class="toggle-switch" style="transform: scale(0.7);">
                            <input type="checkbox" id="songAutoRecognize">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <!-- Recognition Interval -->
                    <div class="slider-group" style="margin-bottom: 6px;">
                        <label style="font-size: 7px;">Recognition Interval</label>
                        <div class="slider-row">
                            <input type="range" id="songRecognizeInterval" min="10" max="120" step="5" value="30">
                            <span id="songRecognizeIntervalValue" style="font-size: 8px;">30s</span>
                        </div>
                    </div>
                    
                    <!-- Lyrics Scroll Speed -->
                    <div class="slider-group" style="margin-bottom: 6px;">
                        <label style="font-size: 7px;">Lyrics Scroll Speed</label>
                        <div class="slider-row">
                            <input type="range" id="lyricsScrollSpeed" min="1" max="15" step="1" value="5">
                            <span id="lyricsScrollSpeedValue" style="font-size: 8px;">5s</span>
                        </div>
                    </div>
                </div>
                
                <!-- API Settings (collapsed by default) -->
                <details style="margin-top: 8px; border-top: 1px solid #333; padding-top: 8px;">
                    <summary style="font-size: 7px; color: #888; cursor: pointer;">üîë API Settings</summary>
                    <div style="padding-top: 8px;">
                        
                        <!-- Provider Selection -->
                        <div style="margin-bottom: 8px;">
                            <label style="font-size: 7px; color: #888;">Recognition Provider</label>
                            <select id="songProvider" style="margin-top: 2px; width: 100%;">
                                <option value="acoustid">‚≠ê AcoustID (kostenlos, unlimitiert)</option>
                                <option value="acrcloud">ACRCloud (100/Tag)</option>
                                <option value="audd">AudD (300/Monat)</option>
                            </select>
                        </div>
                        
                        <!-- AcoustID Settings (default) -->
                        <div id="acoustidSettings">
                            <div style="font-size: 7px; color: #4f4; margin-bottom: 4px;">‚≠ê AcoustID - Open Source, keine Limits!</div>
                            <input type="text" id="acoustidApiKey" placeholder="API Key (instant verf√ºgbar)" 
                                   style="width: 100%; font-size: 7px; padding: 4px; background: #111; border: 1px solid #333; border-radius: 3px; color: #aaa;">
                            <a href="https://acoustid.org/api-key" target="_blank" style="font-size: 6px; color: #4f4;">API Key holen (sofort, kostenlos) ‚Üí</a>
                            <div style="font-size: 6px; color: #666; margin-top: 4px;">Nutzt MusicBrainz Datenbank</div>
                        </div>
                        
                        <!-- ACRCloud Settings -->
                        <div id="acrcloudSettings" style="display: none;">
                            <div style="font-size: 7px; color: #666; margin-bottom: 4px;">ACRCloud (100 free/day)</div>
                            <input type="text" id="acrAccessKey" placeholder="Access Key" 
                                   style="width: 100%; font-size: 7px; padding: 4px; background: #111; border: 1px solid #333; border-radius: 3px; color: #aaa; margin-bottom: 4px;">
                            <input type="password" id="acrAccessSecret" placeholder="Access Secret" 
                                   style="width: 100%; font-size: 7px; padding: 4px; background: #111; border: 1px solid #333; border-radius: 3px; color: #aaa;">
                            <a href="https://console.acrcloud.com/" target="_blank" style="font-size: 6px; color: #48f;">Get free API key ‚Üí</a>
                        </div>
                        
                        <!-- AudD Settings -->
                        <div id="auddSettings" style="display: none;">
                            <div style="font-size: 7px; color: #666; margin-bottom: 4px;">AudD (300 free/month)</div>
                            <input type="text" id="auddApiToken" placeholder="API Token" 
                                   style="width: 100%; font-size: 7px; padding: 4px; background: #111; border: 1px solid #333; border-radius: 3px; color: #aaa;">
                            <a href="https://audd.io/" target="_blank" style="font-size: 6px; color: #48f;">Get free API key ‚Üí</a>
                        </div>
                        
                    </div>
                </details>
                
            </div>
        </div>
        
        <!-- AI Image -->
        <div class="panel" id="panelAiBild">
            <h3>
                <span>AI Image</span>
                <span class="header-icons">
                    <span class="visibility-btn" id="aiVisibilityBtn" title="Enable/Disable AI Image"></span>
                    <span class="minimize-btn">‚ñº</span>
                </span>
            </h3>
            <div class="panel-content">
                <!-- Overlay Opacity -->
                <div class="slider-group">
                    <label>Overlay Opacity</label>
                    <div class="slider-row">
                        <input type="range" id="aiOverlayOpacity" min="0" max="100" value="0">
                        <span id="aiOverlayOpacityValue">0%</span>
                    </div>
                </div>
                
                <!-- Model Selection -->
                <div id="aiModelSelector" style="margin-top: 4px;">
                    <div class="ai-model-group" data-provider="local">
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <span style="font-size: 7px; color: #888;">Port:</span>
                            <input type="number" id="comfyPort" value="8188" min="1" max="65535" style="width: 60px; padding: 2px 4px; font-size: 9px; background: #222; border: 1px solid #444; border-radius: 3px; color: #fff;">
                            <button id="comfyConnectBtn" class="reset-btn" style="margin: 0; padding: 2px 6px; font-size: 8px;" title="Reconnect">üîå</button>
                        </div>
                        <div id="localSdStatus" style="font-size: 7px; color: #888; margin-top: 2px;">üñ•Ô∏è Connecting to localhost:8188</div>
                        <div style="font-size: 6px; color: #555; margin-top: 2px;">
                            <a href="#" id="testComfyLink" style="color: #88f;">Test in Browser</a> |
                            Start: <code style="color: #aaa;">python main.py --enable-cors-header</code>
                        </div>
                        <div style="margin-top: 4px;">
                            <label style="font-size: 7px; color: #888;">Checkpoint Model</label>
                            <select id="comfyCheckpoint" style="margin-top: 2px; width: 100%; font-size: 8px;">
                                <option value="">-- Connect to ComfyUI first --</option>
                            </select>
                        </div>
                        <button id="startComfyBtn" class="reset-btn" style="margin-top: 4px; font-size: 7px; padding: 3px 6px;">üöÄ Start ComfyUI</button>
                    </div>
                </div>
                
                <!-- Resolution Selection -->
                <div class="ai-resolution-selector" style="margin-top: 6px;">
                    <label style="font-size: 7px; color: #888;">Output Size</label>
                    <select id="aiResolutionSelect" style="margin-top: 2px; width: 100%;">
                        <optgroup label="16:9 Landscape">
                            <option value="1920x1080" selected>1920√ó1080 (Full HD)</option>
                            <option value="2560x1440">2560√ó1440 (2K)</option>
                            <option value="3840x2160">3840√ó2160 (4K)</option>
                            <option value="1280x720">1280√ó720 (HD)</option>
                        </optgroup>
                        <optgroup label="9:16 Portrait">
                            <option value="1080x1920">1080√ó1920 (Full HD)</option>
                            <option value="1440x2560">1440√ó2560 (2K)</option>
                            <option value="720x1280">720√ó1280 (HD)</option>
                        </optgroup>
                        <optgroup label="Square 1:1">
                            <option value="2048x2048">2048√ó2048</option>
                            <option value="1024x1024">1024√ó1024</option>
                            <option value="512x512">512√ó512</option>
                            <option value="384x384">384√ó384</option>
                            <option value="300x300">300√ó300 (rounded to 320)</option>
                            <option value="150x150">150√ó150 (rounded to 192)</option>
                        </optgroup>
                        <optgroup label="Other">
                            <option value="1920x1200">1920√ó1200 (16:10)</option>
                            <option value="2560x1080">2560√ó1080 (21:9)</option>
                            <option value="3440x1440">3440√ó1440 (21:9)</option>
                            <option value="custom">Custom...</option>
                        </optgroup>
                    </select>
                    <div id="aiCustomResolution" style="display:none; margin-top: 4px;">
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <input type="number" id="aiCustomWidth" value="1920" min="64" max="4096" step="64" style="width: 60px; padding: 2px; font-size: 9px; background: #222; border: 1px solid #444; border-radius: 3px; color: #fff;">
                            <span style="color: #888;">√ó</span>
                            <input type="number" id="aiCustomHeight" value="1080" min="64" max="4096" step="64" style="width: 60px; padding: 2px; font-size: 9px; background: #222; border: 1px solid #444; border-radius: 3px; color: #fff;">
                        </div>
                        <div style="font-size: 6px; color: #666; margin-top: 2px;">‚ö†Ô∏è Values rounded to 64px grid</div>
                    </div>
                    <div id="aiResolutionDisplay" style="font-size: 7px; color: #888; text-align: center; margin-top: 2px;">1920√ó1080px</div>
                </div>
                
                <!-- Upscale Settings -->
                <div style="margin-top: 4px; padding: 6px; background: #151518; border-radius: 4px; border: 1px solid #333;">
                    <div class="interaction-mode" style="margin: 0;">
                        <label>
                            <input type="checkbox" id="aiUpscaleEnabled">
                            ‚ö° Fast Mode (Generate small ‚Üí Upscale)
                        </label>
                    </div>
                    <div id="aiUpscaleSettings" style="display: none; margin-top: 6px;">
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <div style="flex: 1;">
                                <label style="font-size: 7px; color: #888;">Generate at</label>
                                <select id="aiGenerateResolution" style="margin-top: 2px; width: 100%;">
                                    <optgroup label="16:9 (Fast)">
                                        <option value="512x288">üöÄ 512√ó288 (Fastest)</option>
                                        <option value="640x360">640√ó360</option>
                                        <option value="768x432" selected>768√ó432 (Balanced)</option>
                                        <option value="896x512">896√ó512</option>
                                    </optgroup>
                                    <optgroup label="9:16 Portrait">
                                        <option value="288x512">288√ó512</option>
                                        <option value="432x768">432√ó768</option>
                                    </optgroup>
                                    <optgroup label="1:1 Square">
                                        <option value="512x512">512√ó512</option>
                                        <option value="384x384">384√ó384</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 7px; color: #888;">Method</label>
                                <select id="aiUpscaleMethod" style="margin-top: 2px;">
                                    <option value="nearest-exact">Nearest (Pixelig)</option>
                                    <option value="bilinear">Bilinear (Weich)</option>
                                    <option value="bicubic">Bicubic (Balanced)</option>
                                    <option value="lanczos" selected>Lanczos (Scharf)</option>
                                </select>
                            </div>
                        </div>
                        <div id="aiUpscaleInfo" style="font-size: 7px; color: #4a4; margin-top: 4px; text-align: center;">768√ó432 ‚Üí 1920√ó1080 (~6x faster)</div>
                    </div>
                </div>
                
                <!-- Speed Presets -->
                <div style="margin-top: 4px; padding: 6px; background: linear-gradient(135deg, #1a2a1a, #0a1a0a); border-radius: 4px; border: 1px solid #4a4;">
                    <div style="font-size: 7px; color: #4a4; margin-bottom: 4px;">üöÄ Speed Presets</div>
                    <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                        <button id="presetMaxFps" class="reset-btn" style="flex: 1; font-size: 8px; padding: 4px; background: linear-gradient(135deg, #4a4, #282);" title="1 Step, 512x288, No Save">üöÄ MAX FPS</button>
                        <button id="presetFast" class="reset-btn" style="flex: 1; font-size: 8px; padding: 4px;" title="4 Steps, 768x432">Fast</button>
                        <button id="presetBalanced" class="reset-btn" style="flex: 1; font-size: 8px; padding: 4px;" title="4 Steps, 1024x576">Balanced</button>
                        <button id="presetQuality" class="reset-btn" style="flex: 1; font-size: 8px; padding: 4px;" title="8 Steps, Full Res">Quality</button>
                    </div>
                    <div id="presetStatus" style="font-size: 7px; color: #888; margin-top: 4px; text-align: center;">-</div>
                </div>
                
                <!-- Advanced Settings (collapsible) -->
                <details style="margin-top: 4px;">
                    <summary style="font-size: 8px; color: #888; cursor: pointer; padding: 4px; background: #111; border-radius: 3px;">üîß Advanced Settings</summary>
                    <div style="padding: 6px; background: #0a0a0a; border-radius: 0 0 4px 4px;">
                        <!-- Steps -->
                        <div class="slider-group">
                            <label style="font-size: 7px;">Steps</label>
                            <div class="slider-row">
                                <input type="range" id="aiSteps" min="1" max="30" value="4">
                                <span id="aiStepsValue" style="font-size: 8px; min-width: 20px;">4</span>
                            </div>
                        </div>
                        <!-- CFG -->
                        <div class="slider-group">
                            <label style="font-size: 7px;">CFG Scale</label>
                            <div class="slider-row">
                                <input type="range" id="aiCfg" min="1" max="15" step="0.5" value="1">
                                <span id="aiCfgValue" style="font-size: 8px; min-width: 20px;">1</span>
                            </div>
                        </div>
                        <!-- Sampler -->
                        <div style="margin-top: 4px;">
                            <label style="font-size: 7px; color: #888;">Sampler</label>
                            <select id="aiSampler" style="margin-top: 2px; width: 100%;">
                                <optgroup label="Fast (Turbo/Lightning)">
                                    <option value="euler" selected>‚ö° Euler (Fastest)</option>
                                    <option value="euler_ancestral">Euler Ancestral</option>
                                    <option value="ddim">DDIM</option>
                                </optgroup>
                                <optgroup label="Quality">
                                    <option value="dpmpp_2m">DPM++ 2M</option>
                                    <option value="dpmpp_2m_sde">DPM++ 2M SDE</option>
                                    <option value="dpmpp_sde">DPM++ SDE</option>
                                </optgroup>
                                <optgroup label="Other">
                                    <option value="heun">Heun</option>
                                    <option value="lms">LMS</option>
                                    <option value="uni_pc">UniPC</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                </details>
                
                <!-- Buffer Status -->
                <div id="aiModelBufferStatus" style="font-size: 8px; color: #888; margin-top: 4px;"></div>
                
                <!-- Settings -->
                <div class="interaction-mode" style="margin-top: 4px;">
                    <label>
                        <input type="checkbox" id="aiAutoGenerate">
                        Auto-Generation
                    </label>
                </div>
                <div class="interaction-mode">
                    <label>
                        <input type="checkbox" id="aiBufferMode">
                        Buffer Mode
                    </label>
                </div>
                
                <!-- Buffer Settings (erscheint wenn Buffer Mode aktiv) -->
                <div id="aiBufferSettings" style="display:none; padding: 4px; background: #111; border-radius: 3px; margin-top: 4px;">
                    <div class="slider-group" style="margin-bottom: 4px;">
                        <label>Buffer Size</label>
                        <div class="slider-row">
                            <input type="range" id="aiBufferSize" min="5" max="50" value="24">
                            <span id="aiBufferSizeValue">24</span>
                        </div>
                    </div>
                    <div class="interaction-mode">
                        <label>
                            <input type="checkbox" id="aiBufferLoop" checked>
                            Loop Buffer
                        </label>
                    </div>
                    <div class="interaction-mode">
                        <label>
                            <input type="checkbox" id="aiBufferShuffle">
                            Shuffle
                        </label>
                    </div>
                    <div id="aiBufferStatus" style="font-size: 8px; color: #4f4; margin-top: 4px;">Buffer: 0/24</div>
                    
                    <!-- Playback Controls -->
                    <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid #333;">
                        <div style="display: flex; gap: 4px; align-items: center;">
                            <button id="aiPrevBtn" class="reset-btn" style="margin:0; padding:4px 8px; font-size:10px;" title="Previous">‚èÆ</button>
                            <button id="aiPlaybackBtn" class="reset-btn" style="margin:0; padding:4px 10px; font-size:12px;" title="Play">‚ñ∂</button>
                            <button id="aiNextBtn" class="reset-btn" style="margin:0; padding:4px 8px; font-size:10px;" title="Next">‚è≠</button>
                            <button id="aiClearBufferBtn" class="reset-btn" style="margin:0; padding:4px 6px; font-size:8px; margin-left:auto;" title="Clear Buffer">üóë</button>
                        </div>
                        <!-- BPM Sync -->
                        <div class="interaction-mode" style="margin-top: 4px;">
                            <label>
                                <input type="checkbox" id="aiBpmSync">
                                üéµ Sync to BPM
                            </label>
                        </div>
                        <div id="aiBpmSyncOptions" style="display:none; margin-top: 4px; padding: 4px; background: #0a0a0a; border-radius: 3px;">
                            <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                                <button class="ai-bpm-btn active" data-beats="1" title="Every beat">1</button>
                                <button class="ai-bpm-btn" data-beats="2" title="Every 2 beats">2</button>
                                <button class="ai-bpm-btn" data-beats="4" title="Every 4 beats">4</button>
                                <button class="ai-bpm-btn" data-beats="8" title="Every 8 beats">8</button>
                                <button class="ai-bpm-btn" data-beats="16" title="Every 16 beats">16</button>
                            </div>
                            <div id="aiBpmStatus" style="font-size: 7px; color: #888; margin-top: 4px;">Waiting for BPM...</div>
                        </div>
                        <!-- Manual Speed (disabled when BPM sync) -->
                        <div class="slider-group" style="margin-top: 4px;" id="aiSpeedControl">
                            <label>Speed</label>
                            <div class="slider-row">
                                <input type="range" id="aiPlaybackSpeed" min="200" max="5000" step="100" value="2000">
                                <span id="aiPlaybackSpeedValue">2.0s</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Continuous Generation -->
                    <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid #333;">
                        <button id="aiContinuousGenBtn" class="reset-btn" style="width: 100%; font-size: 8px;">üîÑ Fill Buffer</button>
                    </div>
                </div>
                
                <!-- Stream Mode (outside buffer settings - always visible) -->
                <div style="margin-top: 6px; padding: 6px; background: linear-gradient(135deg, #1a1a2e, #16213e); border-radius: 4px; border: 1px solid #4af3;">
                    <div style="display: flex; gap: 4px; align-items: center;">
                        <button id="aiStreamModeBtn" class="reset-btn" style="flex: 1; font-size: 9px; padding: 6px; background: linear-gradient(135deg, #2a4a6a, #1a3a5a);">üì° Stream</button>
                    </div>
                    <div id="aiStreamStatus" style="font-size: 7px; color: #888; margin-top: 4px; text-align: center;">Continuous output without buffer</div>
                    <div class="slider-group" style="margin-top: 4px;">
                        <label style="font-size: 7px;">Pause between images</label>
                        <div class="slider-row">
                            <input type="range" id="aiStreamPause" min="0" max="5000" step="100" value="0">
                            <span id="aiStreamPauseValue" style="font-size: 8px;">0ms</span>
                        </div>
                    </div>
                    <div class="interaction-mode" style="margin: 4px 0 0 0;">
                        <label style="font-size: 8px;">
                            <input type="checkbox" id="aiSaveImages" checked>
                            üíæ Save to disk (uncheck for temp only)
                        </label>
                    </div>
                </div>
                
                <!-- Post-Processing Upscale (Client-Side) -->
                <div style="margin-top: 6px; padding: 6px; background: linear-gradient(135deg, #2a1a2e, #1e1628); border-radius: 4px; border: 1px solid #a4f;">
                    <div style="font-size: 7px; color: #a4f; margin-bottom: 4px;">üîç Client-Side Upscale</div>
                    <div class="interaction-mode" style="margin: 0;">
                        <label style="font-size: 8px;">
                            <input type="checkbox" id="aiPostUpscaleEnabled">
                            Enable Post-Upscaling
                        </label>
                    </div>
                    <div id="aiPostUpscaleSettings" style="display: none; margin-top: 6px;">
                        <div style="display: flex; gap: 6px; align-items: center;">
                            <div style="flex: 1;">
                                <label style="font-size: 7px; color: #888;">Target Size</label>
                                <select id="aiPostUpscaleTarget" style="margin-top: 2px; width: 100%;">
                                    <option value="1920x1080" selected>1920√ó1080</option>
                                    <option value="2560x1440">2560√ó1440</option>
                                    <option value="3840x2160">3840√ó2160</option>
                                    <option value="1280x720">1280√ó720</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 7px; color: #888;">Method</label>
                                <select id="aiPostUpscaleMethod" style="margin-top: 2px;">
                                    <option value="nearest">Nearest (Pixel)</option>
                                    <option value="bilinear">Bilinear</option>
                                    <option value="bicubic">Bicubic</option>
                                    <option value="lanczos" selected>Lanczos</option>
                                </select>
                            </div>
                        </div>
                        <div class="slider-group" style="margin-top: 4px;">
                            <label style="font-size: 7px;">Sharpen</label>
                            <div class="slider-row">
                                <input type="range" id="aiPostUpscaleSharpen" min="0" max="100" value="0">
                                <span id="aiPostUpscaleSharpenValue" style="font-size: 8px;">0%</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 4px; margin-top: 6px;">
                            <button id="aiUpscaleCurrentBtn" class="reset-btn" style="flex: 1; font-size: 8px; padding: 4px;">üîç Upscale Current</button>
                            <button id="aiUpscaleBufferBtn" class="reset-btn" style="flex: 1; font-size: 8px; padding: 4px;">üîç Upscale Buffer</button>
                        </div>
                    </div>
                </div>
                
                <!-- Prompt Input -->
                <div style="display: flex; gap: 4px; margin-top: 4px;">
                    <input type="text" id="aiPromptInput" placeholder="Enter prompt..." style="flex: 1; padding: 4px 6px; font-size: 9px; background: #222; border: 1px solid #444; border-radius: 3px; color: #fff;">
                    <button class="reset-btn" id="aiClearPrompt" style="margin: 0; width: auto; padding: 4px 6px; font-size: 8px;" title="Clear prompt">‚ùå</button>
                    <button class="reset-btn" id="aiGenerateBtn" style="margin: 0; width: auto; padding: 4px 8px;" title="Generate new image">üé®</button>
                    <button class="reset-btn" id="aiRegenerateBtn" style="margin: 0; width: auto; padding: 4px 6px; font-size: 10px; background: linear-gradient(135deg, #4a4, #282);" title="Regenerate with same prompt">üîÑ</button>
                </div>
                
                <!-- Prompt Modifiers -->
                <div style="margin-top: 6px; padding: 6px; background: #151520; border-radius: 4px; border: 1px solid #333;">
                    <div style="font-size: 7px; color: #888; margin-bottom: 4px;">‚ú® Prompt Enhancers</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px;">
                        <label class="prompt-modifier-toggle" title="Adds: cinematic lighting, dramatic atmosphere, film grain, depth of field, volumetric lighting">
                            <input type="checkbox" id="modifierCinematic">
                            <span>üé¨ Cinematic</span>
                        </label>
                        <label class="prompt-modifier-toggle" title="Adds: anatomically correct, proper proportions, correct fingers. Also enhances negative prompt.">
                            <input type="checkbox" id="modifierAnatomy">
                            <span>üßç Anatomy</span>
                        </label>
                        <label class="prompt-modifier-toggle" title="Adds: 8k uhd, highly detailed, sharp focus, intricate details">
                            <input type="checkbox" id="modifierHighDetail">
                            <span>üî¨ Detail</span>
                        </label>
                        <label class="prompt-modifier-toggle" title="Adds: masterpiece, best quality, trending on artstation">
                            <input type="checkbox" id="modifierArtistic">
                            <span>üé® Artistic</span>
                        </label>
                    </div>
                </div>
                
                <!-- Text Filter Options -->
                <div style="display: flex; gap: 8px; margin-top: 4px; font-size: 8px; color: #888;">
                    <label style="display: flex; align-items: center; gap: 3px;">
                        <input type="checkbox" id="aiFilterNouns" checked>
                        Nouns
                    </label>
                    <label style="display: flex; align-items: center; gap: 3px;">
                        <input type="checkbox" id="aiFilterVerbs">
                        Verbs
                    </label>
                    <label style="display: flex; align-items: center; gap: 3px;">
                        <input type="checkbox" id="aiFilterAdj">
                        Adjectives
                    </label>
                </div>
                
                <!-- Preview -->
                <div style="position: relative;">
                    <div id="aiImagePreview">
                        <span class="placeholder">No Image</span>
                    </div>
                    <button id="aiRegenerateOverlay" class="reset-btn" style="position: absolute; top: 4px; right: 4px; margin: 0; padding: 4px 8px; font-size: 10px; background: rgba(0,0,0,0.7); border: 1px solid #4a4; opacity: 0.7;" title="Regenerate">üîÑ</button>
                </div>
                
                <!-- Buffer Thumbnails -->
                <div id="aiBufferThumbs" style="display: none; margin-top: 4px;"></div>
                
                <!-- Crossfade -->
                <div class="interaction-mode" style="margin-top: 6px;">
                    <label>
                        <input type="checkbox" id="aiCrossfadeEnabled">
                        Crossfade
                    </label>
                </div>
                
                <!-- Use as 3D Texture -->
                <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid #333;">
                    <div class="interaction-mode">
                        <label>
                            <input type="checkbox" id="aiAsTexture">
                            üé® Use as 3D Texture
                        </label>
                    </div>
                    <div class="interaction-mode" style="margin-left: 16px;">
                        <label style="color: #ccc;">
                            <input type="checkbox" id="aiTextureApplyToAll" checked>
                            <span style="font-size: 8px;">Apply to All Models</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- RIGHT COLUMN: EQ, Beat -->
    <div id="ui-right">
        <div class="panel">
            <h3><span>Input EQ</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="eq-container">
                <div class="eq-band">
                    <label><span>Low</span><span id="eqLowValue">0</span></label>
                    <input type="range" id="eqLow" min="-24" max="24" step="0.5" value="0">
                </div>
                <div class="eq-band">
                    <label><span>Mid</span><span id="eqMidValue">0</span></label>
                    <input type="range" id="eqMid" min="-24" max="24" step="0.5" value="0">
                </div>
                <div class="eq-band">
                    <label><span>High</span><span id="eqHighValue">0</span></label>
                    <input type="range" id="eqHigh" min="-24" max="24" step="0.5" value="0">
                </div>
            </div>
            <button class="reset-btn" id="eqReset">Reset</button>
        </div>
        
        <div class="panel">
            <h3><span>Beat</span><span class="minimize-btn">‚ñº</span></h3>
            <div class="beat-display">
                <div class="bpm-value" id="bpmValue">-- BPM</div>
                <div class="beat-indicator" id="beatIndicator"></div>
            </div>
            <div class="slider-group">
                <label>Sensitivity</label>
                <div class="slider-row">
                    <input type="range" id="beatSensitivity" min="0" max="100" value="50">
                    <span id="beatSensitivityValue">50%</span>
                </div>
            </div>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="beatFlashEnabled" checked>
                    Flash
                </label>
            </div>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="beatPulseEnabled">
                    Pulse
                </label>
            </div>
            <div class="interaction-mode">
                <label>
                    <input type="checkbox" id="beatRotationEnabled">
                    Beat-Rotation
                </label>
            </div>
            <div class="slider-group">
                <label>Rotation</label>
                <div class="slider-row">
                    <input type="range" id="rotationSpeed" min="0" max="100" value="20">
                    <span id="rotationSpeedValue">20%</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Canvas -->
    <canvas id="canvas"></canvas>
    <canvas id="aiOverlayCanvas"></canvas>
    
    <!-- Hidden Master Controls (for sync with top bar) -->
    <div style="display: none;">
        <input type="range" id="masterGain" min="-60" max="12" step="0.5" value="0">
        <span id="gainValue">0 dB</span>
        <div class="level-meter" id="levelMeter">
            <div class="level-meter-fill"></div>
        </div>
    </div>
    
    <!-- Interval Overview Modal -->
    <div id="intervalModal" class="modal-overlay">
        <div class="modal-content modal-content-wide">
            <div class="modal-header">
                <h2>üéµ Interval Overview</h2>
                <div class="modal-header-controls">
                    <label>Set:</label>
                    <select id="intervalSetSelect" class="modal-select">
                        <!-- Dynamically populated -->
                    </select>
                </div>
                <span class="modal-close" id="intervalModalClose">‚úï</span>
            </div>
            <div class="modal-body modal-body-split">
                <div class="modal-left">
                    <p class="modal-description">Clara's synesthetic mapping: Click = Preview, Double-click = Load</p>
                    <div id="intervalGrid" class="interval-grid">
                        <!-- Dynamically populated -->
                    </div>
                </div>
                <div class="modal-right">
                    <div class="preview-section">
                        <h3 id="intervalPreviewTitle">Select an interval</h3>
                        <div id="intervalPreviewContainer" class="preview-3d-container">
                            <!-- 3D Renderer inserted here -->
                        </div>
                        <div class="preview-info">
                            <div class="legend-compact">
                                <span>‚óè Point</span>
                                <span>‚ñ¨ Small</span>
                                <span>‚¨≠ Oval</span>
                                <span>‚ï± Line</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <span class="hint">üí° Double-click an interval to load it into the main scene</span>
            </div>
        </div>
    </div>

    <!-- Import Map for ES Modules -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <!-- Main Entry Point -->
    <script type="module" src="js/main.js"></script>

    <!-- Panel Minimize & Fullscreen Script -->
    <script>
        // Panel minimize
        document.querySelectorAll('.panel h3').forEach(header => {
            header.addEventListener('click', (e) => {
                if (e.target.closest('.visibility-btn')) return;
                header.closest('.panel').classList.toggle('minimized');
            });
        });
        
        // NOTE: Model visibility wird in main.js gesteuert - KEIN doppelter Handler hier!
        
        // Fullscreen Toggle
        document.getElementById('fullscreenToggle').addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });
        
        // Collapse All Panels Toggle - Minimiert alle Panels (nur Header sichtbar)
        const collapseBtn = document.getElementById('collapsePanelsToggle');
        let allMinimized = true;
        
        // Start minimized: Alle Panels beim Start minimieren (au√üer Spectrum)
        document.querySelectorAll('.panel').forEach(panel => {
            // Spectrum Panel offen lassen f√ºr Canvas-Initialisierung
            if (panel.id !== 'panelSpectrum') {
                panel.classList.add('minimized');
            }
        });
        if (collapseBtn) collapseBtn.classList.add('active');
        if (collapseBtn) {
            collapseBtn.addEventListener('click', () => {
                allMinimized = !allMinimized;
                collapseBtn.classList.toggle('active', allMinimized);
                
                // Alle Panels minimieren/maximieren
                document.querySelectorAll('.panel').forEach(panel => {
                    if (allMinimized) {
                        panel.classList.add('minimized');
                    } else {
                        panel.classList.remove('minimized');
                    }
                });
            });
        }
        
        // Keyboard Shortcut
        document.addEventListener('keydown', (e) => {
            // Fullscreen: F11
            if (e.key === 'F11') {
                e.preventDefault();
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }
            // Collapse Panels: C
            if (e.key === 'c' || e.key === 'C') {
                // Nicht wenn in einem Input-Feld
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') return;
                
                allMinimized = !allMinimized;
                if (collapseBtn) {
                    collapseBtn.classList.toggle('active', allMinimized);
                }
                
                // Alle Panels minimieren/maximieren
                document.querySelectorAll('.panel').forEach(panel => {
                    if (allMinimized) {
                        panel.classList.add('minimized');
                    } else {
                        panel.classList.remove('minimized');
                    }
                });
            }
        });
    </script>
</body>
</html>
